{"version":3,"file":"leaflet-elevation.min.js","sources":["../src/utils.js","../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/components.js","../src/chart.js","../src/marker.js","../src/summary.js","../src/options.js","../src/control.js","../src/distance.js","../src/altitude.js","../src/time.js","../src/slope.js","../src/speed.js","../src/acceleration.js","../src/index.js"],"sourcesContent":["/**\n * Recursive deep merge objects.\n * Alternative to L.Util.setOptions(this, options).\n */\nexport function deepMerge(target, ...sources) {\n\tif (!sources.length) return target;\n\tconst source = sources.shift();\n\tif (isObject(target) && isObject(source)) {\n\t\tfor (const key in source) {\n\t\t\tif (isObject(source[key])) {\n\t\t\t\tif (!target[key]) Object.assign(target, {\n\t\t\t\t\t[key]: {}\n\t\t\t\t});\n\t\t\t\tdeepMerge(target[key], source[key]);\n\t\t\t} else {\n\t\t\t\tObject.assign(target, {\n\t\t\t\t\t[key]: source[key]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\treturn deepMerge(target, ...sources);\n}\n\n/**\n * Wait for document load before execute function.\n */\nexport function deferFunc(f) {\n\tif (document.readyState !== 'complete') window.addEventListener(\"load\", f, { once: true });\n\telse f();\n}\n/**\n * Debounce function to limit events are being fired.\n */\nexport function debounce(func, wait, context, immediate) {\n\tvar timeout;\n\treturn function() {\n\t\tvar args = arguments;\n\t\tclearTimeout(timeout);\n\t\ttimeout  = setTimeout(function() {\n\t\t\ttimeout = null;\n\t\tif (!immediate) func.apply(context, args);\n\t\t}, wait);\n\t\tif (immediate && !timeout) func.apply(context, args);\n\t};\n}\n\nconst SEC  = 1000;\nconst MIN  = SEC * 60;\nconst HOUR = MIN * 60;\nconst DAY  = HOUR * 24;\n\n/**\n * Convert a duration time (millis) to a human readable string (%Dd %H:%M'%S\")\n */\nexport function formatTime(t) {\n\tlet d = Math.floor(t / DAY);\n\tlet h = Math.floor( (t - d * DAY) / HOUR);\n\tlet m = Math.floor( (t - d * DAY - h * HOUR) / MIN);\n\tlet s = Math.round( (t - d * DAY - h * HOUR - m * MIN) / SEC);\n\tif ( s === 60 ) { m++; s = 0; }\n\tif ( m === 60 ) { h++; m = 0; }\n\tif ( h === 24 ) { d++; h = 0; }\n\treturn (d ? d + \"d \" : '') + h.toString().padStart(2, 0) + ':' + m.toString().padStart(2, 0) + \"'\" + s.toString().padStart(2, 0) + '\"';\n}\n\n/**\n * Simple GeoJSON data loader.\n */\nexport function GeoJSONLoader(data, control) {\n\tif (typeof data === \"string\") {\n\t\tdata = JSON.parse(data);\n\t}\n\tcontrol = control || this;\n\n  let distanceMarkers = (\n\t\t\tcontrol.options.distanceMarkers === true\n\t\t\t\t? { lazy: true }\n\t\t\t\t: L.extend({ lazy: true }, control.options.distanceMarkers)\n\t);\n\n\tlet layer = L.geoJson(data, {\n\t\tdistanceMarkers: distanceMarkers,\n\t\tstyle: (feature) => {\n\t\t\tlet style = L.extend({}, control.options.polyline);\n\t\t\tif (control.options.theme) {\n\t\t\t\tstyle.className += ' ' + control.options.theme;\n\t\t\t}\n\t\t\treturn style;\n\t\t},\n\t\tpointToLayer: (feature, latlng) => {\n\t\t\tlet marker = L.marker(latlng, { icon: control.options.gpxOptions.marker_options.wptIcons[''] });\n\t\t\tlet prop   = feature.properties;\n\t\t\tlet desc   = prop.desc ? prop.desc : '';\n\t\t\tlet name   = prop.name ? prop.name : '';\n\t\t\tif (name || desc) {\n\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\n\t\t\t}\n\t\t\tcontrol._registerCheckPoint({latlng:latlng, label: name}, true);\n\t\t\tcontrol.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\n\t\t\treturn marker;\n\t\t},\n\t\tonEachFeature: (feature, layer) => {\n\t\t\tif (feature.geometry && feature.geometry.type == 'Point') return;\n\n\t\t\t// Standard GeoJSON\n\t\t\t// control.addData(feature, layer);  // NB uses \"_addGeoJSONData\"\n\n\t\t\t// Extended GeoJSON\n\t\t\tlayer._latlngs.forEach((point, i, data) => {\n\t\t\t\t// same properties as L.GPX layer\n\t\t\t\tpoint.meta = { time: null, ele: null, hr: null, cad: null, atemp: null };\n\t\t\t\tif(\"alt\" in point) point.meta.ele = point.alt;\n\t\t\t\tif(feature.properties) {\n\t\t\t\t\tlet prop = feature.properties;\n\t\t\t\t\tif(\"coordTimes\" in prop) point.meta.time = new Date(Date.parse(prop.coordTimes[i]));\n\t\t\t\t\telse if(\"times\" in prop) point.meta.time = new Date(Date.parse(prop.times[i]));\n\t\t\t\t\telse if(\"time\" in prop) point.meta.time = new Date(Date.parse((typeof prop.time === 'object' ? prop.time[i] : prop.time)));\n\t\t\t\t\tif(\"heartRates\" in prop) point.meta.hr = parseInt(prop.heartRates[i]);\n\t\t\t\t\telse if(\"heartRate\" in prop) point.meta.hr = parseInt((typeof prop.heartRate === 'object' ? prop.heartRate[i] : prop.heartRate));\n\t\t\t\t\t// TODO: cadence, temperature\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontrol.addData(layer); // NB uses \"_addGPXData\"\n\n\t\t\t// Postpone adding the distance markers (lazy: true)\n\t\t\tif(control.options.distanceMarkers && distanceMarkers.lazy) {\n        layer.on('add remove', (e) => {\n          let path = e.target;\n          if (L.DistanceMarkers && path instanceof L.Polyline) {\n            path[e.type + 'DistanceMarkers']();\n          }\n        });\n      }\n\n\t\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"geojson\", name: data.name });\n\t\t},\n\t});\n\n\tL.Control.Elevation._d3LazyLoader.then(() => {\n\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info })\n\t});\n\n\treturn layer;\n}\n\n/**\n * Check DOM element visibility.\n */\nexport function isDomVisible(elem) {\n\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\n}\n\n/**\n * Check object type.\n */\nexport function isObject(item) {\n\treturn (item && typeof item === 'object' && !Array.isArray(item));\n}\n\n/**\n * Check DOM element viewport visibility.\n */\nexport function isVisible(elem) {\n\tif (!elem) return false;\n\n\tlet styles = window.getComputedStyle(elem);\n\n\tfunction isVisibleByStyles(elem, styles) {\n\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\n\t}\n\n\tfunction isAboveOtherElements(elem, styles) {\n\t\tlet boundingRect = elem.getBoundingClientRect();\n\t\tlet left = boundingRect.left + 1;\n\t\tlet right = boundingRect.right - 1;\n\t\tlet top = boundingRect.top + 1;\n\t\tlet bottom = boundingRect.bottom - 1;\n\t\tlet above = true;\n\n\t\tlet pointerEvents = elem.style.pointerEvents;\n\n\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\n\n\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\n\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\n\n\t\t// Only for completely visible elements\n\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\n\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\n\n\t\telem.style.pointerEvents = pointerEvents;\n\n\t\treturn above;\n\t}\n\n\tif (!isVisibleByStyles(elem, styles)) return false;\n\tif (!isAboveOtherElements(elem, styles)) return false;\n\treturn true;\n}\n\n/**\n * Check JSON object type.\n */\nexport function isJSONDoc(doc, lazy) {\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\n\tif (typeof doc === \"string\" && lazy) {\n\t\tdoc = doc.trim();\n\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\n\t} else {\n\t\ttry {\n\t\t\tJSON.parse(doc.toString());\n\t\t} catch (e) {\n\t\t\tif (typeof doc === \"object\" && lazy) return true;\n\t\t\tconsole.warn(e);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n}\n\n/**\n * Check XML object type.\n */\nexport function isXMLDoc(doc, lazy) {\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\n\tif (typeof doc === \"string\" && lazy) {\n\t\tdoc = doc.trim();\n\t\treturn doc.indexOf(\"<\") == 0;\n\t} else {\n\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\n\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\n\t}\n}\n\n/**\n * Async JS script download.\n */\nexport function lazyLoader(url, skip, loader) {\n\tif (skip === false) {\n\t\treturn Promise.resolve();\n\t}\n\tif (loader instanceof Promise) {\n\t\treturn loader;\n\t}\n\treturn new Promise((resolve, reject) => {\n\t\tlet tag = document.createElement(\"script\");\n\t\ttag.addEventListener('load', resolve, { once: true });\n\t\ttag.src = url;\n\t\tdocument.head.appendChild(tag);\n\t});\n}\n\n/**\n * Generate download data event.\n */\nexport function saveFile(dataURI, fileName) {\n\tlet a = create('a', '', { href: dataURI, target: '_new', download: fileName || \"\", style: \"display:none;\" });\n\tlet b = document.body;\n\tb.appendChild(a);\n\ta.click();\n\tb.removeChild(a);\n}\n\n/**\n * Wait for element visible before execute function.\n */\nexport function waitHolder(elem) {\n\treturn new Promise((resolve, reject) => {\n\t\tlet ticking = false;\n\t\tlet scrollFn = () => {\n\t\t\tif (!ticking) {\n\t\t\t\tL.Util.requestAnimFrame(() => {\n\t\t\t\t\tif (isVisible(elem)) {\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t\tticking = false;\n\t\t\t\t});\n\t\t\t\tticking = true;\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener('scroll', scrollFn);\n\t\tif (elem) elem.addEventListener('mouseenter', scrollFn, { once: true });\n\t\tscrollFn();\n\t});\n}\n\n/**\n * A little bit safier than L.DomUtil.addClass\n */\nexport function addClass(targetNode, className) {\n\tif (targetNode) className.split(\" \").every(s => s && L.DomUtil.addClass(targetNode, s));\n}\n\n/**\n * A little bit safier than L.DomUtil.removeClass()\n */\nexport function removeClass(targetNode, className) {\n\tif (targetNode) className.split(\" \").every(s => s && L.DomUtil.removeClass(targetNode, s));\n}\n\nexport function toggleClass(targetNode, className, conditional) {\n\treturn (conditional ? addClass : removeClass).call(null, targetNode, className)\n}\n\nexport function replaceClass(targetNode, removeClassName, addClassName) {\n  if (removeClassName) removeClass(targetNode, removeClassName);\n  if (addClassName) addClass(targetNode, addClassName);\n}\n\nexport function style(targetNode, name, value) {\n\tif (typeof value === \"undefined\") return L.DomUtil.getStyle(targetNode, name);\n\telse return targetNode.style.setProperty(name, value);\n}\n\nexport function toggleStyle(targetNode, name, value, conditional) {\n  return style(targetNode, name, conditional ? value : '');\n}\n\nexport function toggleEvent(leafletElement, eventName, handler, conditional) {\n\treturn leafletElement[conditional ? 'on' : 'off'](eventName, handler);\n}\n\n/**\n * A little bit shorter than L.DomUtil.create()\n */\nexport function create(tagName, className, attributes, parent) {\n\tlet elem = L.DomUtil.create(tagName, className || \"\");\n\tif (attributes) setAttributes(elem, attributes);\n\tif (parent) append(parent, elem);\n\treturn elem;\n}\n\n/**\n * Same as node.appendChild()\n */\nexport function append(parent, child) {\n\treturn parent.appendChild(child);\n}\n\n/**\n * Same as node.insertAdjacentElement()\n */\nexport function insert(parent, child, position) {\n\treturn parent.insertAdjacentElement(position, child);\n}\n\n/**\n * Loop for node.setAttribute()\n */\nexport function setAttributes(elem, attrs) {\n\tfor (let k in attrs) { elem.setAttribute(k, attrs[k]); }\n}\n\n/**\n * Same as node.querySelector().\n */\nexport function select(selector, context) {\n\treturn (context || document).querySelector(selector);\n}\n\n/**\n * Alias for L.DomEvent.on.\n */\nexport const on = L.DomEvent.on;\n\n/**\n * Alias for L.DomEvent.off.\n */\nexport const off = L.DomEvent.off;\n\n/**\n * Alias for L.DomUtil.hasClass.\n */\nexport const hasClass = L.DomUtil.hasClass;\n\n\nexport function randomId() {\n\treturn Math.random().toString(36).substr(2, 9);\n}\n\nexport function each(obj, fn) {\n\tfor (let i in obj) fn(obj[i], i);\n}\n","// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","export const Colors = {\n\t'lightblue': { area: '#3366CC', alpha: 0.45, stroke: '#3366CC' },\n\t'magenta'  : { area: '#FF005E' },\n\t'yellow'   : { area: '#FF0' },\n\t'purple'   : { area: '#732C7B' },\n\t'steelblue': { area: '#4682B4' },\n\t'red'      : { area: '#F00' },\n\t'lime'     : { area: '#9CC222', line: '#566B13' }\n};\n\nexport const Area = ({\n\twidth,\n\theight,\n\txAttr,\n\tyAttr,\n\tscaleX,\n\tscaleY,\n\tinterpolation = \"curveLinear\"\n}) => {\n\treturn d3.area()\n\t\t.curve(typeof interpolation === 'string' ? d3[interpolation] : interpolation)\n\t\t.x(d => (d.xDiagCoord = scaleX(d[xAttr])))\n\t\t.y0(height)\n\t\t.y1(d => scaleY(d[yAttr]));\n};\n\nexport const Path = ({\n\tname,\n\tcolor,\n\tstrokeColor,\n\tstrokeOpacity,\n\tfillOpacity,\n}) => {\n\tlet path = d3.create('svg:path')\n\n\tif (name) path.classed(name, true);\n\n\tpath.style(\"pointer-events\", \"none\");\n\n\tpath\n\t.attr(\"fill\", color || '#3366CC')\n\t.attr(\"stroke\", strokeColor || '#000')\n\t.attr(\"stroke-opacity\", strokeOpacity || '1')\n\t.attr(\"fill-opacity\", fillOpacity || '0.8');\n\n\treturn path;\n};\n\nexport const Axis = ({\n\ttype = \"axis\",\n\ttickSize = 6,\n\ttickPadding = 3,\n\tposition,\n\theight,\n\twidth,\n\taxis,\n\tscale,\n\tticks,\n\ttickFormat,\n\tlabel,\n\tlabelX,\n\tlabelY,\n\tname = \"\",\n\tonAxisMount,\n}) => {\n\treturn g => {\n\t\tlet [w, h] = [0, 0];\n\t\tif (position == \"bottom\") h = height;\n\t\tif (position == \"right\")  w = width;\n\n\t\tif (axis == \"x\" && type == \"grid\") {\n\t\t\ttickSize = -height;\n\t\t} else if (axis == \"y\" && type == \"grid\") {\n\t\t\ttickSize = -width;\n\t\t}\n\n\t\tlet axisScale = d3[\"axis\" + position.replace(/\\b\\w/g, l => l.toUpperCase())]()\n\t\t\t.scale(scale)\n\t\t\t.ticks(ticks)\n\t\t\t.tickPadding(tickPadding)\n\t\t\t.tickSize(tickSize)\n\t\t\t.tickFormat(tickFormat);\n\n\t\tlet axisGroup = g.append(\"g\")\n\t\t\t.attr(\"class\", [axis, type, position, name].join(\" \"))\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\n\t\t\t.call(axisScale);\n\n\t\tif (label) {\n\t\t\taxisGroup.append(\"svg:text\")\n\t\t\t\t.attr(\"x\", labelX)\n\t\t\t\t.attr(\"y\", labelY)\n\t\t\t\t.text(label);\n\t\t}\n\n\t\tif (onAxisMount) {\n\t\t\taxisGroup.call(onAxisMount);\n\t\t}\n\n\t\treturn axisGroup;\n\t};\n};\n\nexport const Grid = (props) => {\n\tprops.type = \"grid\";\n\treturn Axis(props);\n};\n\nexport const HeightFocusLine = ({\n\ttheme,\n\txCoord = 0,\n\tyCoord = 0,\n\tlength = 0,\n}) => {\n\treturn line => line\n\t\t.attr(\"class\", theme + \" height-focus line\")\n\t\t.attr(\"x1\", xCoord)\n\t\t.attr(\"x2\", xCoord)\n\t\t.attr(\"y1\", yCoord)\n\t\t.attr(\"y2\", length);\n};\n\nexport const HeightFocusLabel = ({\n\ttheme,\n\txCoord = 0,\n\tyCoord = 0,\n\tlabel,\n}) => {\n\treturn text => {\n\t\ttext\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\n\t\t\t.style(\"pointer-events\", \"none\")\n\t\t\t.attr(\"x\", xCoord + 5)\n\t\t\t.attr(\"y\", yCoord);\n\n\t\tlet y = text.select(\".height-focus-y\");\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\n\n\t\ty\n\t\t\t.attr(\"class\", \"height-focus-y\")\n\t\t\t.text(label);\n\n\t\ttext.selectAll('tspan').attr(\"x\", xCoord + 5);\n\n\t\treturn text;\n\t};\n};\n\nexport const HeightFocusMarker = ({\n\ttheme,\n\txCoord = 0,\n\tyCoord = 0,\n}) => {\n\treturn circle => circle\n\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\n\t\t.attr(\"transform\", \"translate(\" + xCoord + \",\" + yCoord + \")\")\n\t\t.attr(\"r\", 6)\n\t\t.attr(\"cx\", 0)\n\t\t.attr(\"cy\", 0);\n};\n\nexport const LegendItem = ({\n\tname,\n  label,\n\twidth,\n\theight,\n\tmargins = {},\n\tcolor,\n\tpath\n}) => {\n\treturn g => {\n\t\tg\n\t\t\t.attr(\"class\", \"legend-item legend-\" + name.toLowerCase())\n\t\t\t.attr(\"data-name\", name);\n\n\t\tconst svg = d3.select(g.node().ownerSVGElement || g);\n\n\t\tg.on('click.legend', () => svg.dispatch(\"legend_clicked\", {\n\t\t\tdetail: {\n\t\t\t\tpath: path.node(),\n\t\t\t\tname: name,\n\t\t\t\tlegend: g.node(),\n\t\t\t\tenabled: !path.classed('leaflet-hidden'),\n\t\t\t}\n\t\t}));\n\n\t\tg.append(\"svg:rect\")\n\t\t\t.attr(\"x\", (width / 2) - 50)\n\t\t\t.attr(\"y\", height + margins.bottom / 2)\n\t\t\t.attr(\"width\", 50)\n\t\t\t.attr(\"height\", 10)\n\t\t\t.attr(\"fill\", color)\n\t\t\t.attr(\"stroke\", \"#000\")\n\t\t\t.attr(\"stroke-opacity\", \"0.5\")\n\t\t\t.attr(\"fill-opacity\", \"0.25\");\n\n\t\tg.append('svg:text')\n\t\t\t.text(L._(label || name))\n\t\t\t.attr(\"x\", (width / 2) + 5)\n\t\t\t.attr(\"font-size\", 10)\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\n\t\t\t.style(\"font-weight\", \"700\")\n\t\t\t.attr('y', height + margins.bottom / 2)\n\t\t\t.attr('dy', \"0.75em\");\n\n\t\treturn g;\n\t}\n};\n\nexport const MouseFocusLine = ({\n\txCoord = 0,\n\theight,\n}) => {\n\treturn line => line\n\t\t.attr('class', 'mouse-focus-line')\n\t\t.attr('x2', xCoord)\n\t\t.attr('y2', 0)\n\t\t.attr('x1', xCoord)\n\t\t.attr('y1', height);\n};\n\nexport const MouseFocusLabel = ({\n\txCoord,\n\tyCoord,\n\tlabelX = \"\",\n\tlabelY = \"\",\n\twidth,\n}) => {\n\treturn g => {\n\n\t\tg.attr('class', 'mouse-focus-label');\n\n\t\tlet rect = g.select(\".mouse-focus-label-rect\");\n\t\tlet text = g.select(\".mouse-focus-label-text\");\n\t\tlet y    = text.select(\".mouse-focus-label-y\");\n\t\tlet x    = text.select(\".mouse-focus-label-x\");\n\n\t\tif (!rect.node()) rect = g.append(\"svg:rect\");\n\t\tif (!text.node()) text = g.append(\"svg:text\");\n\t\tif (!y.node())    y    = text.append(\"svg:tspan\");\n\t\tif (!x.node())    x    = text.append(\"svg:tspan\");\n\n\t\ty.text(labelY);\n\t\tx.text(labelX);\n\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\n\t\tlet xAlign = 0;\n\t\tlet yAlign = 0;\n\t\tlet bbox   = { width: 0, height: 0 };\n\t\ttry { bbox = text.node().getBBox(); } catch (e) { return g; }\n\n\t\tif (xCoord) xAlign = xCoord + (xCoord < width / 2 ? 10 : -bbox.width - 10);\n\t\tif (yCoord) yAlign = Math.max(yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\n\n\t\trect\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\n\t\t\t.attr(\"x\", xAlign - 5)\n\t\t\t.attr(\"y\", yAlign - 5)\n\t\t\t.attr(\"width\", bbox.width + 10)\n\t\t\t.attr(\"height\", bbox.height + 10)\n\t\t\t.attr(\"rx\", 3)\n\t\t\t.attr(\"ry\", 3);\n\t\ttext\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\n\t\t\t.style(\"font-weight\", \"700\")\n\t\t\t.attr(\"y\", yAlign);\n\t\ty\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\n\t\t\t.attr(\"dy\", \"1em\");\n\t\tx\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\n\t\t\t.attr(\"dy\", \"2em\");\n\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\n\n\t\treturn g;\n\t};\n};\n\nexport const Ruler = ({\n\theight,\n\twidth,\n}) => {\n\treturn g => {\n\n\t\tg.data([{\n\t\t\t\t\"x\": 0,\n\t\t\t\t\"y\": height,\n\t\t\t}])\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \")\");\n\n\t\tlet rect   = g.selectAll('.horizontal-drag-rect')\n\t\t\t.data([{ w: width }]);\n\n\t\tlet line   = g.selectAll('.horizontal-drag-line')\n\t\t\t.data([{ w: width }]);\n\n\t\tlet label  = g.selectAll('.horizontal-drag-label')\n\t\t\t.data([{ w: width - 8 }]);\n\n\t\tlet symbol = g.selectAll('.horizontal-drag-symbol')\n\t\t\t.data([{\n\t\t\t\t\"type\": d3.symbolTriangle,\n\t\t\t\t\"x\": width + 7,\n\t\t\t\t\"y\": 0,\n\t\t\t\t\"angle\": -90,\n\t\t\t\t\"size\": 50\n\t\t\t}]);\n\n\t\trect.exit().remove();\n\t\tline.exit().remove();\n\t\tlabel.exit().remove();\n\t\tsymbol.exit().remove();\n\n\t\trect.enter()\n\t\t\t.append(\"svg:rect\")\n\t\t\t.attr(\"class\", \"horizontal-drag-rect\")\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", -8)\n\t\t\t.attr(\"height\", 8)\n\t\t\t.attr('fill', 'none')\n\t\t\t.attr('pointer-events', 'all')\n\t\t\t.merge(rect)\n\t\t\t.attr(\"width\", d => d.w);\n\n\t\tline.enter()\n\t\t\t.append(\"svg:line\")\n\t\t\t.attr(\"class\", \"horizontal-drag-line\")\n\t\t\t.attr(\"x1\", 0)\n\t\t\t.merge(line)\n\t\t\t.attr(\"x2\", d => d.w);\n\n\t\tlabel.enter()\n\t\t\t.append(\"svg:text\")\n\t\t\t.attr(\"class\", \"horizontal-drag-label\")\n\t\t\t.attr(\"text-anchor\", \"end\")\n\t\t\t.attr(\"y\", -8)\n\t\t\t.merge(label)\n\t\t\t.attr(\"x\", d => d.w)\n\n\t\tsymbol\n\t\t\t.enter()\n\t\t\t.append(\"svg:path\")\n\t\t\t.attr(\"class\", \"horizontal-drag-symbol\")\n\t\t\t.merge(symbol)\n\t\t\t.attr(\"d\",\n\t\t\t\td3.symbol()\n\t\t\t\t.type(d => d.type)\n\t\t\t\t.size(d => d.size)\n\t\t\t)\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \") rotate(\" + d.angle + \")\");\n\n\t\treturn g;\n\t}\n};\n\nexport const Domain = ({\n\tmin,\n\tmax,\n\tattr,\n\tname,\n\tforceBounds\n}) => function(data) {\n\tattr = attr || name;\n\tlet domain = data && data.length ? d3.extent(data, d => d[attr]) : [0, 1];\n\tif (typeof min !== \"undefined\" && (min < domain[0] || forceBounds)) {\n\t\tdomain[0] = min;\n\t}\n\tif (typeof max !== \"undefined\" && (max > domain[1] || forceBounds)) {\n\t\tdomain[1] = max;\n\t}\n\treturn domain;\n};\n\nexport const Range = ({\n\taxis\n}) => function(width, height) {\n\tif (axis == 'x')      return [0, width];\n\telse if (axis == 'y') return [height, 0];\n};\n\nexport const Scale = ({\n\tdata,\n\tattr,\n\tmin,\n\tmax,\n\tforceBounds,\n\trange,\n}) => {\n\treturn d3.scaleLinear()\n\t\t.range(range)\n\t\t.domain(Domain({min, max, attr, forceBounds})(data));\n};\n\nexport const Bisect = ({\n\tdata = [0, 1],\n\tscale,\n\tx,\n\tattr\n}) => {\n\treturn d3\n\t\t.bisector(d => d[attr])\n\t\t.left(data, scale.invert(x));\n};\n\nexport const Chart = ({\n\twidth,\n\theight,\n\tmargins = {},\n\truler,\n}) => {\n\n\tconst _width   = width - margins.left - margins.right;\n\tconst _height  = height - margins.top - margins.bottom;\n\n\t// SVG Container\n\tconst svg   = d3.create(\"svg:svg\").attr(\"class\", \"background\");\n\n\t// SVG Groups\n\tconst g     = svg.append(\"g\");\n\tconst panes = {\n\t\tgrid   : g.append(\"g\").attr(\"class\", \"grid\"),\n\t\tarea   : g.append('g').attr(\"class\", \"area\"),\n\t\tpoint  : g.append('g').attr(\"class\", \"point\"),\n\t\taxis   : g.append('g').attr(\"class\", \"axis\"),\n\t\tbrush  : g.append(\"g\").attr(\"class\", \"brush\"),\n\t\ttooltip: g.append(\"g\").attr(\"class\", \"tooltip\").attr('display', 'none'),\n\t\truler  : g.append('g').attr('class', 'ruler'),\n\t\tlegend : g.append('g').attr(\"class\", \"legend\"),\n\t};\n\n\t// SVG Paths\n\tconst clipPath      = panes.area.append(\"svg:clipPath\").attr(\"id\", 'elevation-clipper');\n\tconst clipRect      = clipPath.append(\"svg:rect\");\n\n\t// Canvas Paths\n\tconst foreignObject = panes.area.append('svg:foreignObject');\n\tconst canvas        = foreignObject.append('xhtml:canvas').attr('class', 'canvas-plot');\n\tconst context       = canvas.node().getContext('2d');\n\n\t// Mouse Focus\n\tconst dragG         = panes.ruler;\n\tconst focusG        = panes.tooltip;\n\tconst brushG        = panes.brush;\n\n\tfocusG.append('svg:line')\n\t\t.call(\n\t\t\tMouseFocusLine({\n\t\t\t\txCoord: 0,\n\t\t\t\theight: _height\n\t\t\t})\n\t\t);\n\n\tfocusG.append(\"g\")\n\t\t.call(\n\t\t\tMouseFocusLabel({\n\t\t\t\txCoord: 0,\n\t\t\t\tyCoord: 0,\n\t\t\t\theight: _height,\n\t\t\t\twidth : _width,\n\t\t\t\tlabelX: \"\",\n\t\t\t\tlabelY: \"\",\n\t\t\t})\n\t\t);\n\n\n\t// Add the brushing\n\tlet brush           = d3.brushX().on('start.cursor end.cursor brush.cursor', () => brushG.select(\".overlay\").attr('cursor', null));\n\n\t// Scales\n\tconst scale         = (opts) => ({ x: Scale(opts.x), y: Scale(opts.y)});\n\n\tlet utils = {\n\t\tclipPath,\n\t\tcanvas,\n\t\tcontext,\n\t\tdragG,\n\t\tfocusG,\n\t\tbrush,\n\t};\n\n\tlet chart = {\n\t\tsvg,\n\t\tg,\n\t\tpanes,\n\t\tutils,\n\t\tscale,\n\t};\n\n\t// Resize\n\tchart._resize  = ({\n\t\twidth,\n\t\theight,\n\t\tmargins = {},\n\t\truler,\n\t}) => {\n\n\t\tconst _width   = width - margins.left - margins.right;\n\t\tconst _height  = height - margins.top - margins.bottom;\n\n\t\tsvg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n\t\t\t.attr(\"width\", width)\n\t\t\t.attr(\"height\", height);\n\n\t\tg.attr(\"transform\", \"translate(\" + margins.left + \",\" + margins.top + \")\");\n\n\t\tclipRect\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"y\", 0)\n\t\t\t.attr(\"width\", _width)\n\t\t\t.attr(\"height\", _height);\n\n\t\tforeignObject\n\t\t\t.attr('width', _width)\n\t\t\t.attr('height', _height);\n\n\t\tcanvas\n\t\t\t.attr('width', _width)\n\t\t\t.attr('height', _height);\n\n\t\tif (ruler) {\n\t\t\tdragG    .call(Ruler({ height: _height, width: _width }));\n\t\t}\n\n\t\tbrushG.call(brush.extent( [ [0,0], [_width, _height] ] ));\n\t\tbrushG.select(\".overlay\").attr('cursor', null);\n\n\t\tchart._width  = _width;\n\t\tchart._height = _height;\n\n\t\tchart.svg.dispatch('resize', { detail: { width: _width, height: _height } } );\n\n\t};\n\n\tchart.pane = (name) => {\n\t\tif (!panes[name]) {\n\t\t\tpanes[name] = g.append('g').attr(\"class\", name);\n\t\t}\n\t\treturn panes[name];\n\t}\n\n\tchart.get = (name) => utils[name];\n\n\tchart._resize({ width, height, margins});\n\n\treturn chart;\n};\n","import 'leaflet-i18n';\nimport * as _  from './utils';\nimport * as D3 from './components';\n\nexport var Chart = L.Class.extend({\n\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\n\n\tinitialize: function(opts, control) {\n\t\tthis.options       = opts;\n\t\tthis.control       = control;\n\n\t\tthis._data         = [];\n\n\t\t// cache registered components\n\t\tthis._props        = {\n\t\t\tscales     : {},\n\t\t\tpaths      : {},\n\t\t\tareas      : {},\n\t\t\tgrids      : {},\n\t\t\taxes       : {},\n\t\t\tlegendItems: {},\n\t\t\tfocusLabels: {},\n\t\t};\n\n\t\tthis._scales       = {};\n\t\tthis._domains      = {};\n\t\tthis._ranges       = {};\n\t\tthis._paths        = {};\n\n\t\tthis._brushEnabled = opts.dragging;\n\t\tthis._zoomEnabled  = opts.zooming;\n\n\t\tif (opts.imperial) {\n\t\t\tthis._xLabel  = \"mi\";\n\t\t\tthis._yLabel  = \"ft\";\n\t\t} else {\n\t\t\tthis._xLabel  = opts.xLabel;\n\t\t\tthis._yLabel  = opts.yLabel;\n\t\t}\n\n\t\tlet chart       = this._chart = D3.Chart(opts);\n\n\t\t// SVG Container\n\t\tlet svg         = this._container = chart.svg;\n\n\t\t// Panes\n\t\tthis._grid      = chart.pane('grid');\n\t\tthis._area      = chart.pane('area');\n\t\tthis._point     = chart.pane('point');\n\t\tthis._axis      = chart.pane('axis');\n\t\tthis._legend    = chart.pane('legend');\n\n\t\t// Scales\n\t\tthis._initScale();\n\n\t\t// Helpers\n\t\tthis._clipPath  = chart.get('clipPath');\n\t\tthis._canvas    = chart.get('canvas');\n\t\tthis._context   = chart.get('context');\n\t\tthis._dragG     = chart.get('dragG');\n\t\tthis._focusG    = chart.get('focusG');\n\t\tthis._brush     = chart.get('brush');\n\n\t\t// Tooltip\n\t\tthis._focusline  = this._focusG.select('.mouse-focus-line');\n\t\tthis._focuslabel = this._focusG.select('.mouse-focus-label');\n\n\t\tthis._zoom = d3.zoom();\n\t\tthis._drag = d3.drag();\n\n\t\t// Interactions\n\t\tthis._initInteractions();\n\n\t\t// svg.on('resize', (e)=>console.log(e.detail));\n\n\t},\n\n\tupdate: function(props) {\n\t\tif (props) {\n\t\t\tif (props.data) this._data = props.data;\n\t\t\tif (props.options) this.options = props.options;\n\t\t}\n\n\t\tthis._updateScale();\n\t\tthis._updateArea();\n\t\tthis._updateAxis();\n\t\tthis._updateLegend();\n\t\tthis._updateClipper();\n\n\t\treturn this;\n\t},\n\n\trender: function() {\n\t\treturn container => container.append(() => this._container.node());\n\t},\n\n\tclear: function() {\n\t\tthis._resetDrag();\n\t\tthis._area.selectAll('path').attr(\"d\", \"M0 0\");\n\t\tthis._context.clearRect(0, 0, this._width(), this._height());\n\t\tif (this._path) {\n\t\t\t// this._x.domain([0, 1]);\n\t\t\t// this._y.domain([0, 1]);\n\t\t}\n\t},\n\n\t_drawPath: function(name) {\n\t\tlet opts   = this.options;\n\t\tlet ctx    = this._context;\n\n\t\tlet path   = this._paths[name];\n\t\tlet area   = this._props.areas[name];\n\t\tlet node   = path.node();\n\t\tlet scaleX = this._scales[area.scaleX];\n\t\tlet scaleY = this._scales[area.scaleY];\n\n\t\tarea = L.extend({}, area, {\n\t\t\twidth        : this._width(),\n\t\t\theight       : this._height(),\n\t\t\tscaleX       : scaleX,\n\t\t\tscaleY       : scaleY\n\t\t});\n\n\t\tif (!scaleY || !scaleY) {\n\t\t\treturn console.warn('Unable to render path:' + name);\n\t\t}\n\n\t\tpath.datum(this._data).attr(\"d\", D3.Area(area));\n\n\t\tif (path.classed('leaflet-hidden')) return;\n\n\t\tif (opts.preferCanvas) {\n\t\t\tpath.classed('canvas-path', true);\n\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(0, 0);\n\t\t\tlet p = new Path2D(path.attr('d'));\n\n\t\t\tctx.strokeStyle = path.attr('stroke');\n\t\t\tctx.fillStyle   = path.attr('fill');\n\t\t\tctx.lineWidth   = 1.25;\n\t\t\tctx.globalCompositeOperation = 'source-over';\n\n\t\t\t// stroke opacity\n\t\t\tctx.globalAlpha = path.attr('stroke-opacity') || 0.3;\n\t\t\tctx.stroke(p);\n\n\t\t\t// fill opacity\n\t\t\tctx.globalAlpha = path.attr('fill-opacity')   || 0.45;\n\t\t\tctx.fill(p);\n\n\t\t\tctx.globalAlpha = 1;\n\n\t\t\tctx.closePath();\n\t\t} else {\n\t\t\tthis._area.append(() => node);\n\t\t}\n\t},\n\n\t_hasActiveLayers: function() {\n\t\tconst paths = this._paths;\n\t\tfor (var i in paths) {\n\t\t\tif (!paths[i].classed('leaflet-hidden')) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Initialize \"d3-brush\".\n\t */\n\t_initBrush: function(e) {\n\t\tconst brush   = (e) => {\n\t\t\tlet extent  = e.selection;\n\t\t\tif (extent) {\n\t\t\t\tlet start = this._findIndexForXCoord(extent[0]);\n\t\t\t\tlet end   = this._findIndexForXCoord(extent[1]);\n\t\t\t\tthis.fire('dragged', { dragstart: this._data[start], dragend: this._data[end] });\n\t\t\t}\n\t\t}\n\n\t\tconst focus   = (e) => {\n\t\t\tif (e.type == 'brush' && !e.sourceEvent) return;\n\t\t\tlet rect    = this._chart.panes.brush.select('.overlay').node();\n\t\t\tlet coords  = d3.pointers(e, rect)[0];\n\t\t\tlet xCoord  = coords[0];\n\t\t\tlet item    = this._data[this._findIndexForXCoord(xCoord)];\n\n\t\t\tthis.fire(\"mouse_move\", { item: item, xCoord: xCoord });\n\t\t};\n\n\t\tthis._brush\n\t\t\t.filter((e) => this._brushEnabled && !e.shiftKey && !e.button)\n\t\t\t.on(\"end.update\", brush)\n\t\t\t.on(\"brush.update\", focus);\n\n\t\tthis._chart.panes.brush\n\t\t\t.on(\"mouseenter.focus touchstart.focus\", this.fire.bind(this, \"mouse_enter\"))\n\t\t\t.on(\"mouseout.focus touchend.focus\",     this.fire.bind(this, \"mouse_out\")  )\n\t\t\t.on(\"mousemove.focus touchmove.focus\",   focus                              );\n\n\t},\n\n\t/**\n\t * Initialize \"d3-zoom\"\n\t */\n\t_initClipper: function() {\n\t\tlet svg       = this._container;\n\t\tlet margin    = this.options.margins;\n\n\t\tconst zoom    = this._zoom;\n\n\t\tconst onStart = (e) => {\n\t\t\tif (e.sourceEvent && e.sourceEvent.type == \"mousedown\") svg.style('cursor', 'grabbing');\n\t\t\tif (e.transform.k == 1 && e.transform.x == 0) {\n\t\t\t\tthis._container.classed('zoomed', true);\n\t\t\t}\n\t\t\tthis.zooming = true;\n\t\t};\n\n\t\tconst onEnd  = (e) => {\n\t\t\tif (e.transform.k ==1 && e.transform.x == 0){\n\t\t\t\tthis._container.classed('zoomed', false);\n\t\t\t}\n\t\t\tthis.zooming = false;\n\t\t\tsvg.style('cursor', '');\n\t\t};\n\n\t\tconst onZoom = (e) => {\n\t\t\t// TODO: find a faster way to redraw the chart.\n\t\t\tthis.zooming = false;\n\t\t\tthis._updateScale(); // hacky way for restoring x scale when zooming out\n\t\t\tthis.zooming = true;\n\t\t\tthis._scales.distance = this._x = e.transform.rescaleX(this._x); // calculate x scale at zoom level\n\t\t\tthis._resetDrag();\n\t\t\tif (e.sourceEvent && e.sourceEvent.type == \"mousemove\") {\n\t\t\t\tthis._hideDiagramIndicator();\n\t\t\t}\n\t\t\tthis.fire('zoom');\n\t\t};\n\n\t\tzoom\n\t\t\t.scaleExtent([1, 10])\n\t\t\t.extent([\n\t\t\t\t[margin.left, 0],\n\t\t\t\t[this._width() - margin.right, this._height()]\n\t\t\t])\n\t\t\t.translateExtent([\n\t\t\t\t[margin.left, -Infinity],\n\t\t\t\t[this._width() - margin.right, Infinity]\n\t\t\t])\n\t\t\t.filter((e) => this._zoomEnabled && (e.shiftKey || e.buttons == 4))\n\t\t\t.on(\"start\", onStart)\n\t\t\t.on(\"end\", onEnd)\n\t\t\t.on(\"zoom\", onZoom);\n\n\t\tsvg.call(zoom); // add zoom functionality to \"svg\" group\n\n\t\t// d3.select(\"body\").on(\"keydown.grabzoom keyup.grabzoom\", (e) => svg.style('cursor', e.shiftKey ? 'move' : ''));\n\n\t},\n\n\t_initInteractions: function() {\n\t\tthis._initBrush();\n\t\tthis._initRuler();\n\t\tthis._initClipper();\n\t\tthis._initLegend();\n\t},\n\n\t/**\n\t * Toggle chart data on legend click\n\t */\n\t_initLegend: function() {\n\t\tthis._container.on('legend_clicked', (e) => {\n\t\t\tlet { path, legend, name, enabled } = e.detail;\n\n\t\t\tif (!path) return;\n\n\t\t\tlet label = _.select('text', legend);\n\t\t\tlet rect  = _.select('rect', legend);\n\n\t\t\t_.toggleStyle(label, 'text-decoration-line', 'line-through', enabled);\n\t\t\t_.toggleStyle(rect,  'fill-opacity',         '0',            enabled);\n\t\t\t_.toggleClass(path,  'leaflet-hidden',                       enabled);\n\n\t\t\tthis._updateArea();\n\n\t\t\tthis.fire(\"elepath_toggle\", { path, name, legend, enabled })\n\t\t});\n\t},\n\n\t/**\n\t * Initialize \"ruler\".\n\t */\n\t_initRuler: function() {\n\t\tif (!this.options.ruler) return;\n\n\t\t// const yMax      = this._height();\n\t\tconst formatNum = d3.format(\".0f\");\n\t\tconst drag      = this._drag;\n\n\t\tconst label     = (e, d) => {\n\t\t\tlet yMax      = this._height();\n\t\t\tlet y         = this._dragG.data()[0].y;\n\t\t\tif (y >= yMax || y <= 0) this._dragG.select(\".horizontal-drag-label\").text('');\n\t\t\tthis._hideDiagramIndicator();\n\t\t};\n\n\t\tconst position  = (e, d) => {\n\t\t\tlet yMax      = this._height();\n\t\t\tlet yCoord    = d3.pointers(e, this._area.node())[0][1];\n\t\t\tlet y         = yCoord > 0 ? (yCoord < yMax ? yCoord : yMax) : 0;\n\t\t\tlet z         = this._y.invert(y);\n\t\t\tlet data      = L.extend(this._dragG.data()[0], { y: y });\n\n\t\t\tthis._dragG\n\t\t\t\t.data([data])\n\t\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \")\")\n\t\t\t\t.classed('active', y < yMax);\n\n\t\t\tthis._container.select(\".horizontal-drag-label\")\n\t\t\t\t.text(formatNum(z) + \" \" + this._yLabel);\n\n\t\t\tthis.fire('ruler_filter', { coords: yCoord < yMax && yCoord > 0 ? this._findCoordsForY(yCoord) : [] });\n\t\t}\n\n\t\tdrag\n\t\t.on(\"start end\", label)\n\t\t.on(\"drag\", position);\n\n\t\tthis._dragG.call(drag);\n\n\t},\n\n\t/**\n\t * Initialize x and y scales\n\t */\n\t_initScale: function() {\n\t\tlet opts = this.options;\n\n\t\tthis._registerAxisScale({\n\t\t\taxis    : 'x',\n\t\t\tposition: 'bottom',\n\t\t\tattr    : opts.xAttr,\n\t\t\tmin     : opts.xAxisMin,\n\t\t\tmax     : opts.xAxisMax,\n\t\t\tname    : 'distance'\n\t\t});\n\n\t\tthis._registerAxisScale({\n\t\t\taxis     : 'y',\n\t\t\tposition : 'left',\n\t\t\tattr     : opts.yAttr,\n\t\t\tmin      : opts.yAxisMin,\n\t\t\tmax      : opts.yAxisMax,\n\t\t\tname     : 'altitude'\n\t\t});\n\n\t\tthis._x = this._scales.distance;\n\t\tthis._y = this._scales.altitude;\n\t},\n\n\t_registerAreaPath: function(props) {\n\t\tlet opts = this.options;\n\n\t\tif (!props.xAttr) props.xAttr = opts.xAttr;\n\t\tif (!props.yAttr) props.yAttr = opts.yAttr;\n\t\tif (typeof props.preferCanvas === \"undefined\") props.preferCanvas = opts.preferCanvas;\n\n\t\tlet path = D3.Path(props);\n\n\t\t// Save paths in memory for latter usage\n\t\tthis._paths[props.name]       = path;\n\t\tthis._props.areas[props.name] = props;\n\n\t\tif (opts.legend) {\n\t\t\tthis._props.legendItems[props.name] = {\n\t\t\t\tname   : props.name,\n\t\t\t\tlabel  : props.label,\n\t\t\t\tcolor  : props.color,\n\t\t\t\tpath   : path\n\t\t\t};\n\t\t}\n\n\t},\n\n\t_registerAxisGrid: function(props) {\n\t\tthis._props.grids[props.name || props.axis] = props;\n\t},\n\n\t_registerAxisScale: function(props) {\n\t\tlet opts  = this.options;\n\t\tlet scale = props.scale;\n\n\t\tif (typeof scale !== 'function') {\n\t\t\tscale       = L.extend({\n\t\t\t\tdata       : this._data,\n\t\t\t\tforceBounds: opts.forceAxisBounds\n\t\t\t}, scale);\n\n\t\t\tscale.attr   = scale.attr || props.name;\n\n\t\t\tlet domain   = this._domains[props.name] = D3.Domain(props);\n\t\t\tlet range    = this._ranges[props.name]  = D3.Range(props);\n\t\t\tscale.range  = scale.range  || range(this._width(),this._height());\n\t\t\tscale.domain = scale.domain || domain(this._data);\n\n\t\t\tthis._props.scales[props.name] = scale;\n\n\t\t\tprops.scale = this._scales[props.name] = D3.Scale(scale);\n\t\t}\n\n\t\tif (!props.ticks) {\n\t\t\tif (props.axis == 'x')      props.ticks = opts.xTicks;\n\t\t\telse if (props.axis == 'y') props.ticks = opts.yTicks;\n\t\t}\n\n\t\tthis._props.axes[props.name] = props;\n\n\t\treturn scale;\n\t},\n\n\t/**\n\t * Add a waypoint of interest over the chart\n\t */\n\t_registerCheckPoint: function(point) {\n\t\tif (!this._data.length) return;\n\n\t\tlet item, x, y;\n\n\t\tif (point.latlng) {\n\t\t\titem = this._data[this._findIndexForLatLng(point.latlng)];\n\t\t\tx    = this._x(item.dist);\n\t\t\ty    = this._y(item.z);\n\t\t} else if (!isNaN(point.dist)) {\n\t\t\tx    = this._x(point.dist);\n\t\t\titem = this._data[this._findIndexForXCoord(x)]\n\t\t\ty    = this._y(item.z);\n\t\t} else\n\n\t\tif (isNaN(x) || isNaN(y)) return;\n\n\t\tif (!point.item || !point.item.property('isConnected')) {\n\t\t\tpoint.position = point.position || \"bottom\";\n\n\t\t\tpoint.item = this._point.append('g');\n\n\t\t\tpoint.item.append(\"svg:line\")\n\t\t\t\t.attr(\"y1\", 0)\n\t\t\t\t.attr(\"x1\", 0)\n\t\t\t\t.attr(\"style\",\"stroke: rgb(51, 51, 51); stroke-width: 0.5; stroke-dasharray: 2, 2;\");\n\n\t\t\tpoint.item\n\t\t\t\t.append(\"svg:circle\")\n\t\t\t\t.attr(\"class\", \" height-focus circle-lower\")\n\t\t\t\t.attr(\"r\", 3);\n\n\t\t\tif (point.label) {\n\t\t\t\tpoint.item.append(\"svg:text\")\n\t\t\t\t\t.attr(\"dx\", \"4px\")\n\t\t\t\t\t.attr(\"dy\", \"-4px\");\n\t\t\t}\n\t\t}\n\n\t\tpoint.item\n\t\t\t.datum({\n\t\t\t\tpos: point.position,\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t})\n\t\t\t.attr(\"class\", d => \"point \" + d.pos)\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \")\");\n\n\t\tpoint.item.select('line')\n\t\t\t.datum({\n\t\t\t\ty2: ({'top': -y, 'bottom': this._height() - y})[point.position],\n\t\t\t\tx2: ({'left': -x, 'right': this._width() - x})[point.position] || 0\n\t\t\t})\n\t\t\t.attr(\"y2\", d => d.y2)\n\t\t\t.attr(\"x2\", d => d.x2)\n\n\t\tif (point.label) {\n\t\t\tpoint.item.select('text')\n\t\t\t\t.text(point.label);\n\t\t}\n\n\t},\n\n\t_registerFocusLabel: function(props) {\n\t\tthis._props.focusLabels[props.name] = props;\n\t},\n\n\t_updateArea: function() {\n\t\tlet paths = this._paths;\n\t\t// Reset and update chart profiles\n\t\tthis._context.clearRect(0, 0, this._width(), this._height());\n\t\tfor (var i in paths) {\n\t\t\tif (!paths[i].classed('leaflet-hidden')) {\n\t\t\t\tthis._drawPath(i);\n\t\t\t}\n\t\t}\n\t},\n\n\t_updateAxis: function() {\n\n\t\tlet opts = this.options;\n\n\t\t// Reset chart axis.\n\t\tthis._grid.selectAll('g').remove();\n\t\tthis._axis.selectAll('g').remove();\n\n\t\tlet grids = this._props.grids;\n\t\tlet axes  = this._props.axes;\n\t\tlet props, axis, grid;\n\n\t\tlet gridOpts = {\n\t\t\twidth     : this._width(),\n\t\t\theight    : this._height(),\n\t\t\ttickFormat: \"\",\n\t\t};\n\t\tlet axesOpts  = {\n\t\t\twidth  : this._width(),\n\t\t\theight : this._height(),\n\t\t};\n\n\t\t// Render grids\n\t\tfor (let i in grids) {\n\t\t\tprops = L.extend({}, gridOpts, grids[i]);\n\t\t\tgrid  = D3.Grid(props);\n\t\t\tthis._grid.call(grid);\n\t\t}\n\n\t\t// Render axis\n\t\tfor (let i in axes) {\n\t\t\tif (opts[i] === false || opts[i] === 'summary') continue;\n\t\t\tprops = L.extend({}, axesOpts, axes[i]);\n\t\t\taxis  = D3.Axis(props);\n\t\t\tthis._axis.call(axis);\n\t\t}\n\n\t\t// Adjust axis scale positions\n\t\tthis._axis\n\t\t\t.selectAll('.y.axis.right')\n\t\t\t.each((d, i, n) => {\n\n\t\t\t\tlet axis      = d3.select(n[i]);\n\t\t\t\tlet transform = axis.attr('transform');\n\t\t\t\tlet translate = transform.substring(transform.indexOf(\"(\") + 1, transform.indexOf(\")\")).split(\",\");\n\n\t\t\t\taxis.attr('transform', 'translate(' + (+translate[0] + (i * 40)) + ',' + translate[1] + ')')\n\n\t\t\t\tif (i > 0) {\n\t\t\t\t\taxis.select(':scope > path')         .attr('opacity', 0.25);\n\t\t\t\t\taxis.selectAll(':scope > .tick line').attr('opacity', 0.75);\n\t\t\t\t}\n\n\t\t\t});\n\n\t},\n\n\t_updateClipper: function() {\n\t\tlet margin = this.options.margins;\n\n\t\tthis._zoom\n\t\t\t.scaleExtent([1, 10])\n\t\t\t.extent([\n\t\t\t\t[margin.left, 0],\n\t\t\t\t[this._width() - margin.right, this._height()]\n\t\t\t])\n\t\t\t.translateExtent([\n\t\t\t\t[margin.left, -Infinity],\n\t\t\t\t[this._width() - margin.right, Infinity]\n\t\t\t]);\n\n\t},\n\n\t_updateLegend: function () {\n\t\tlet legends = this._props.legendItems;\n\t\tlet legend;\n\n\t\t// Reset legend items\n\t\tthis._legend.selectAll('g').remove();\n\t\tfor (var i in legends) {\n\t\t\tlegend = D3.LegendItem(\n\t\t\t\tL.extend({\n\t\t\t\t\twidth  : this._width(),\n\t\t\t\t\theight : this._height(),\n\t\t\t\t\tmargins: this.options.margins,\n\t\t\t\t}, legends[i])\n\t\t\t)\n\t\t\tthis._legend.append(\"g\").call(legend);\n\t\t}\n\n\t\t// Get legend items\n\t\tlet items  = this._legend.selectAll('.legend-item');\n\n\t\t// Calculate legend item positions\n\t\tlet n    = items.nodes().length;\n\t\tlet v      = Array(Math.floor(n / 2)).fill(null).map((d, i) => (i + 1) * 2 - (1 - Math.sign(n % 2)));\n\t\tlet rev    = v.slice().reverse().map((d) => -(d));\n\n\t\tif (n % 2 !== 0) {\n\t\t\trev.push(0);\n\t\t}\n\t\tv = rev.concat(v);\n\n\t\t// Get chart margins\n\t\tlet xAxesB  = this._axis.selectAll('.x.axis.bottom').nodes().length;\n\t\tlet marginB = 60 + (xAxesB * 2);\n\t\tlet marginR = n * 30;\n\n\t\t// Adjust chart right margins\n\t\tif (n && this.options.margins.right != marginR) {\n\t\t\tthis.options.margins.right  = marginR;\n\t\t\tthis.fire('margins_updated');\n\t\t}\n\n\t\t// Adjust chart bottom margins\n\t\tif(xAxesB && this.options.margins.bottom != marginB) {\n\t\t\tthis.options.margins.bottom = marginB;\n\t\t\tthis.fire('margins_updated');\n\t\t}\n\n\t\titems\n\t\t\t.each((d, i, n) => {\n\n\t\t\t\tlet legend  = d3.select(n[i]);\n\t\t\t\tlet rect    = legend.select('rect');\n\t\t\t\tlet name    = legend.attr('data-name');\n\t\t\t\tlet path    = this._paths[name];\n\n\t\t\t\tlet tx      = v[i] * 55;\n\t\t\t\tlet ty      = xAxesB * 2;\n\n\t\t\t\tlegend\n\n\t\t\t\t// Adjust legend item positions\n\t\t\t\t.attr(\"transform\", \"translate(\" + tx + \", \" + ty + \")\");\n\n\t\t\t\t// Set initial state (disabled controls)\n\t\t\t\tif (name in this.options && this.options[name] == 'disabled') {\n\t\t\t\t\tpath.classed('leaflet-hidden', true);\n\t\t\t\t\tlegend.select('text').style('text-decoration-line', 'line-through');\n\t\t\t\t\tlegend.select('rect').style('fill-opacity', '0');\n\t\t\t\t}\n\n\t\t\t\t// Apply d3-zoom (bind <clipPath> mask)\n\t\t\t\tif (this._clipPath) {\n\t\t\t\t\tpath.attr('clip-path', 'url(#' + this._clipPath.attr('id') + ')');\n\t\t\t\t}\n\n\t\t\t});\n\t},\n\n\t_updateScale: function() {\n\t\tif (this.zooming) return { x: this._x, y: this._y };\n\n\t\tlet opts = this.options;\n\n\t\tlet scales  = this._scales;\n\t\tlet d = this._domains;\n\t\tlet r = this._ranges;\n\n\t\tfor (let i in scales) {\n\t\t\tscales[i]\n\t\t\t.domain(d[i](this._data))\n\t\t\t.range(r[i](this._width(), this._height()))\n\t\t}\n\n\t\treturn { x: this._x, y: this._y };\n\t},\n\n\t/**\n\t * Calculates chart width.\n\t */\n\t_width: function() {\n\t\treturn this._chart._width;\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height: function() {\n\t\treturn this._chart._height;\n\t},\n\n\t/*\n\t * Finds data entries above a given y-elevation value and returns geo-coordinates\n\t */\n\t_findCoordsForY: function(y) {\n\t\tlet data = this._data;\n\t\tlet z    = this._y.invert(y);\n\n\t\t// save indexes of elevation values above the horizontal line\n\t\tconst list = data.reduce((array, item, index) => {\n\t\t\tif (item.z >= z) array.push(index);\n\t\t\treturn array;\n\t\t}, []);\n\n\t\tlet start = 0;\n\t\tlet next;\n\n\t\t// split index list into blocks of coordinates\n\t\tconst coords = list.reduce((array, _, curr) => {\n\t\t\tnext = curr + 1;\n\t\t\tif (list[next] !== list[curr] + 1 || next === list.length) {\n\t\t\t\tarray.push(\n\t\t\t\t\tlist\n\t\t\t\t\t.slice(start, next)\n\t\t\t\t\t.map(i => data[i].latlng)\n\t\t\t\t);\n\t\t\t\tstart = next;\n\t\t\t}\n\t\t\treturn array;\n\t\t}, []);\n\n\t\treturn coords;\n\t},\n\n\t/*\n\t * Finds a data entry for a given x-coordinate of the diagram\n\t */\n\t_findIndexForXCoord: function(x) {\n\t\treturn d3\n\t\t\t.bisector(d => d[this.options.xAttr])\n\t\t\t.left(this._data || [0, 1], this._x.invert(x));\n\t},\n\n\t/*\n\t * Finds a data entry for a given latlng of the map\n\t */\n\t_findIndexForLatLng: function(latlng) {\n\t\tlet result = null;\n\t\tlet d      = Infinity;\n\t\tthis._data.forEach((item, index) => {\n\t\t\tlet dist = latlng.distanceTo(item.latlng);\n\t\t\tif (dist < d) {\n\t\t\t\td = dist;\n\t\t\t\tresult = index;\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\t/*\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\n\t */\n\t_resetDrag: function() {\n\t\tif (this._chart.panes.brush.select(\".selection\").attr('width')) {\n\t\t\tthis._chart.panes.brush.call(this._brush.clear);\n\t\t\tthis._hideDiagramIndicator();\n\t\t\tthis.fire('reset_drag');\n\t\t}\n\t},\n\n\t_resetZoom: function() {\n\t\tif (this._zoom) {\n\t\t\tthis._zoom.transform(this._chart.svg, d3.zoomIdentity);\n\t\t}\n\t},\n\n\t/**\n\t * Display distance and altitude level (\"focus-rect\").\n\t */\n\t_showDiagramIndicator: function(item, xCoordinate) {\n\t\tlet opts        = this.options;\n\t\tlet yCoordinate = this._y(item[opts.yAttr]);\n\n\t\tthis._focusG.attr(\"display\", null);\n\n\t\tthis._focusline.call(\n\t\t\tD3.MouseFocusLine({\n\t\t\t\txCoord: xCoordinate,\n\t\t\t\theight: this._height()\n\t\t\t})\n\t\t);\n\t\tthis._focuslabel.call(\n\t\t\tD3.MouseFocusLabel({\n\t\t\t\txCoord: xCoordinate,\n\t\t\t\tyCoord: yCoordinate,\n\t\t\t\theight: this._height(),\n\t\t\t\twidth : this._width(),\n\t\t\t\tlabelX: d3.format(\".\"+ opts.decimalsX +\"f\")(item[opts.xAttr]) + \" \" + this._xLabel,\n\t\t\t\tlabelY: d3.format(\".\"+ opts.decimalsY +\"f\")(item[opts.yAttr]) + \" \" + this._yLabel\n\t\t\t})\n\t\t);\n\n\t\t// this._focuslabel.selectAll('tspan').data(Object.values(this._focuslabels));\n\n\t\tlet labels = this._props.focusLabels;\n\t\tlet tooltip = this._focuslabel.select('text');\n\t\tlet label;\n\n\t\tfor (var i in labels) {\n\t\t\tlabel = tooltip.select(\".mouse-focus-label-\" + labels[i].name);\n\n\t\t\tif (!label.size()) {\n\t\t\t\tlabel   = tooltip.append(\"svg:tspan\", \".mouse-focus-label-x\")\n\t\t\t\t\t.attr(\"class\", \"mouse-focus-label-\" + labels[i].name)\n\t\t\t\t\t.attr(\"dy\", \"1.5em\");\n\t\t\t}\n\n\t\t\tlabel.text(typeof labels[i].value !== \"function\" ? labels[i].value : labels[i].value(item) );\n\n\t\t\tthis._focuslabel.select('.mouse-focus-label-x')\n\t\t\t\t.attr(\"dy\", \"1.5em\");\n\t\t}\n\n\t},\n\n\t_hideDiagramIndicator: function() {\n\t\tthis._focusG.attr(\"display\", 'none');\n\t},\n});\n","import 'leaflet-i18n';\nimport * as _  from './utils';\nimport * as D3 from './components';\n\nexport var Marker = L.Class.extend({\n\n\tinitialize: function(options) {\n\t\tthis.options = options;\n\n\t\tif (this.options.imperial) {\n\t\t\tthis._xLabel = \"mi\";\n\t\t\tthis._yLabel = \"ft\";\n\t\t} else {\n\t\t\tthis._xLabel = this.options.xLabel;\n\t\t\tthis._yLabel = this.options.yLabel;\n\t\t}\n\n\t\tif (this.options.marker == 'elevation-line') {\n\t\t\t// this._container = d3.create(\"g\").attr(\"class\", \"height-focus-group\");\n\t\t\tthis._focusline   = d3.create('svg:line');\n\t\t\tthis._focusmarker = d3.create(\"svg:circle\");\n\t\t\tthis._focuslabel  = d3.create(\"svg:text\");\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\t// this._marker   = L.circleMarker([0, 0], { pane: 'overlayPane', radius: 6, fillColor: '#fff', fillOpacity:1, color: '#000', weight:1, interactive: false });\n\t\t\tthis._marker      = L.marker([0, 0], { icon: this.options.markerIcon, zIndexOffset: 1000000, interactive: false });\n\t\t}\n\n\t\tthis._focuslabels = {};\n\n\t\treturn this;\n\t},\n\n\taddTo: function(map) {\n\t\tthis._map = map;\n\t\tif (this.options.marker == 'elevation-line') {\n\t\t\tlet g = this._container = d3.select(map.getPane('elevationPane')).select(\"svg > g\")\n\t\t\t\t.attr(\"class\", \"height-focus-group\");\n\t\t\tg.append(() => this._focusline.node());\n\t\t\tg.append(() => this._focusmarker.node());\n\t\t\tg.append(() => this._focuslabel.node());\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\tthis._marker.addTo(map, { pane: 'overlayPane' });\n\t\t}\n\t\treturn this;\n\t},\n\n\t/**\n\t * Update position marker (\"leaflet-marker\").\n\t */\n\tupdate: function(props) {\n\t\tif (props) this._props = props;\n\t\telse props = this._props;\n\n\t\tif(!props) return;\n\n\t\tif (props.options) this.options = props.options;\n\t\tif (!this._map) this.addTo(props.map);\n\n\t\tlet opts = this.options;\n\t\tlet map = this._map;\n\n\t\tthis._latlng = props.item.latlng;\n\n\t\tlet pos = map.latLngToLayerPoint(this._latlng);\n\n\t\tif (map._rotate) {\n\t\t\tpos = map.rotatedPointToMapPanePoint(pos);\n\t\t}\n\n\t\tlet point = L.extend({}, props.item, pos);\n\n\t\tif (this.options.marker == 'elevation-line') {\n\n\t\t\tlet normalizedAlt = this._height() / props.maxElevation * point.z;\n\t\t\tlet normalizedY   = point.y - normalizedAlt;\n\n\t\t\tthis._container.classed(\"leaflet-hidden\", false);\n\n\t\t\tthis._focusmarker\n\t\t\t\t.call(\n\t\t\t\t\tD3.HeightFocusMarker({\n\t\t\t\t\t\ttheme : opts.theme,\n\t\t\t\t\t\txCoord: point.x,\n\t\t\t\t\t\tyCoord: point.y,\n\t\t\t\t\t}));\n\n\t\t\tthis._focusline\n\t\t\t\t.call(\n\t\t\t\t\tD3.HeightFocusLine({\n\t\t\t\t\t\ttheme : opts.theme,\n\t\t\t\t\t\txCoord: point.x,\n\t\t\t\t\t\tyCoord: point.y,\n\t\t\t\t\t\tlength: normalizedY\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\tthis._focuslabel\n\t\t\t\t.call(\n\t\t\t\t\tD3.HeightFocusLabel({\n\t\t\t\t\t\ttheme : opts.theme,\n\t\t\t\t\t\txCoord: point.x,\n\t\t\t\t\t\tyCoord: normalizedY,\n\t\t\t\t\t\tlabel : d3.format(\".\" + opts.decimalsY + \"f\")(point[opts.yAttr]) + \" \" + this._yLabel\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\tlet labels = this._focuslabels;\n\t\t\tlet tooltip = this._focuslabel;\n\t\t\tlet label;\n\n\t\t\tfor (var i in labels) {\n\t\t\t\tlabel = tooltip.select(\".height-focus-\" + labels[i].name);\n\n\t\t\t\tif (!label.size()) {\n\t\t\t\t\tlabel   = tooltip.append(\"svg:tspan\")\n\t\t\t\t\t\t.attr(\"class\", \"height-focus-\" + labels[i].name)\n\t\t\t\t\t\t.attr(\"dy\", \"1.5em\");\n\t\t\t\t}\n\n\t\t\t\tlabel.text(typeof labels[i].value !== \"function\" ? labels[i].value : labels[i].value(props.item) );\n\n\t\t\t\tthis._focuslabel.select('.height-focus-y')\n\t\t\t\t\t.attr(\"dy\", \"-1.5em\");\n\t\t\t}\n\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\t_.removeClass(this._marker.getElement(), 'leaflet-hidden');\n\t\t\tthis._marker.setLatLng(this._latlng);\n\t\t}\n\t},\n\n\t/*\n\t * Hides the position/height indicator marker drawn onto the map\n\t */\n\tremove: function() {\n\t\tthis._props = null;\n\t\tif (this.options.marker == 'elevation-line') {\n\t\t\tif (this._container) this._container.classed(\"leaflet-hidden\", true);\n\t\t} else if (this.options.marker == 'position-marker') {\n\t\t\t_.addClass(this._marker.getElement(), 'leaflet-hidden');\n\t\t}\n\t},\n\n\tgetLatLng: function() {\n\t\treturn this._latlng;\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height: function() {\n\t\tlet opts = this.options;\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\n\t},\n\n\t_registerFocusLabel: function(props) {\n\t\tthis._focuslabels[props.name] = props;\n\t}\n\n});\n","import 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\n\nexport var Summary = L.Class.extend({\n\tinitialize: function(opts, control) {\n\t\tthis.options = opts;\n\t\tthis.control = control;\n\n\t\tlet summary = this._container = _.create(\"div\", \"elevation-summary \" + (opts.summary ? opts.summary + \"-summary\" : ''));\n\t\t_.style(summary, 'max-width', opts.width ? opts.width + 'px' : '');\n\t},\n\n\trender: function() {\n\t\treturn container => container.append(() => this._container);\n\t},\n\n\treset: function() {\n\t\tthis._container.innerHTML = '';\n\t},\n\n\tappend: function(className, label, value) {\n\t\tthis._container.innerHTML += `<span class=\"${className}\"><span class=\"summarylabel\">${label}</span><span class=\"summaryvalue\">${value}</span></span>`;\n\t\treturn this;\n\t},\n\n\t_registerSummary: function(data) {\n\t\tfor (let i in data) {\n\t\t\tthis.append(i, L._(data[i].label), typeof data[i].value !== \"function\" ? data[i].value : data[i].value(this.control.track_info));\n\t\t}\n\t}\n\n});\n","import * as _ from './utils';\n\nexport var Options = {\n\tautofitBounds: true,\n\tautohide: !L.Browser.mobile,\n\tautohideMarker: true,\n\talmostover: true,\n\taltitude: true,\n\tcollapsed: false,\n\tdetached: true,\n\tdistance: true,\n\tdistanceFactor: 1,\n\tdistanceMarkers: false,\n\tdecimalsX: 2,\n\tdecimalsY: 0,\n\tdragging: !L.Browser.mobile,\n\tdownloadLink: 'link',\n\televationDiv: \"#elevation-div\",\n\tfollowMarker: true,\n\tforceAxisBounds: false,\n\tgpxOptions: {\n\t\tasync: true,\n\t\tmarker_options: {\n\t\t\tstartIconUrl: null,\n\t\t\tendIconUrl: null,\n\t\t\tshadowUrl: null,\n\t\t\twptIcons: {\n\t\t\t\t'': L.divIcon({\n\t\t\t\t\tclassName: 'elevation-waypoint-marker',\n\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\n\t\t\t\t\ticonSize: [30, 30],\n\t\t\t\t\ticonAnchor: [8, 30],\n\t\t\t\t})\n\t\t\t},\n\t\t},\n\t},\n\theight: 200,\n\theightFactor: 1,\n\timperial: false,\n\tinterpolation: \"curveLinear\",\n\tlazyLoadJS: true,\n\tlegend: true,\n\tloadData: {\n\t\tdefer: false,\n\t\tlazy: false,\n\t},\n\tmargins: {\n\t\ttop: 30,\n\t\tright: 30,\n\t\tbottom: 30,\n\t\tleft: 40\n\t},\n\tmarker: 'elevation-line',\n\tmarkerIcon: L.divIcon({\n\t\tclassName: 'elevation-position-marker',\n\t\thtml: '<i class=\"elevation-position-icon\"></i>',\n\t\ticonSize: [32, 32],\n\t\ticonAnchor: [16, 16],\n\t}),\n\tplaceholder: false,\n\tposition: \"topright\",\n\tpolyline: {\n\t\tclassName: 'elevation-polyline',\n\t\tcolor: '#000',\n\t\topacity: 0.75,\n\t\tweight: 5,\n\t\tlineCap: 'round'\n\t},\n\tpolylineSegments: {\n\t\tclassName: 'elevation-polyline-segments',\n\t\tcolor: '#F00',\n\t\tinteractive: false,\n\t},\n\tpreferCanvas: false,\n\treverseCoords: false,\n\truler: true,\n\tskipNullZCoords: false,\n\ttheme: \"lightblue-theme\",\n\tresponsive: true,\n\tsummary: 'inline',\n\tslope: false,\n\tspeed: false,\n\tsLimit: undefined,\n\ttime: false,\n\ttimeFactor: 3600,\n\ttimeFormat: false,\n\tsDeltaMax: undefined,\n\tsInterpolation: \"curveStepAfter\",\n\tsRange: undefined,\n\twidth: 600,\n\txAttr: \"dist\",\n\txLabel: \"km\",\n\txTicks: undefined,\n\tyAttr: \"z\",\n\tyAxisMax: undefined,\n\tyAxisMin: undefined,\n\tyLabel: \"m\",\n\tyTicks: undefined,\n\tzFollow: false,\n\tzooming: !L.Browser.Mobile,\n};\n","import 'leaflet-i18n';\nimport * as _      from './utils';\nimport * as D3     from './components';\nimport { Chart }   from './chart';\nimport { Marker }  from './marker';\nimport { Summary } from './summary';\nimport { Options } from './options';\n\nexport const Elevation = L.Control.Elevation = L.Control.extend({\n\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\n\n\toptions: Options,\n\t__mileFactor: 0.621371,\n\t__footFactor: 3.28084,\n\t__D3:          'https://unpkg.com/d3@6.5.0/dist/d3.min.js',\n\t__TOGEOJSON:   'https://unpkg.com/@tmcw/togeojson@4.3.0/dist/togeojson.umd.js',\n\t__LGEOMUTIL:   'https://unpkg.com/leaflet-geometryutil@0.9.3/src/leaflet.geometryutil.js',\n\t__LALMOSTOVER: 'https://unpkg.com/leaflet-almostover@1.0.1/src/leaflet.almostover.js',\n\t__LDISTANCEM:  'https://unpkg.com/@raruto/leaflet-elevation@1.6.7/libs/leaflet-distance-marker.min.js',\n\n\t/*\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\n\t */\n\taddData: function(d, layer) {\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\n\t\t\tlayer = d;\n\t\t}\n\t\tElevation._d3LazyLoader = _.lazyLoader(\n\t\t\tthis.__D3,\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\n\t\t\tElevation._d3LazyLoader\n\t\t).then(() => {\n\t\t\tthis._addData(d);\n\t\t\tthis._addLayer(layer);\n\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info });\n\t\t});\n\t},\n\n\t/**\n\t * Adds the control to the given map.\n\t */\n\taddTo: function(map) {\n\t\tif (this.options.detached) {\n\t\t\tlet eleDiv = this._initElevationDiv();\n\t\t\tif (!eleDiv.isConnected) _.insert(map.getContainer(), eleDiv, 'afterend');\n\t\t\t_.append(eleDiv, this.onAdd(map));\n\t\t} else {\n\t\t\tL.Control.prototype.addTo.call(this, map);\n\t\t}\n\t\treturn this;\n\t},\n\n\t/*\n\t * Reset data and display\n\t */\n\tclear: function() {\n\t\tif (this._marker) this._marker.remove();\n\t\tif (this._chart)  this._chart.clear();\n\t\tif (this._layers) this._layers.clearLayers();\n\n\t\tthis._data      = [];\n\t\tthis.track_info = {};\n\n\t\tthis._fireEvt(\"eledata_clear\");\n\t},\n\n\t/**\n\t * Disable chart brushing.\n\t */\n\tdisableBrush: function() {\n\t\tthis._chart._brushEnabled = false;\n\t\tthis._resetDrag();\n\t},\n\n\t/**\n\t * Enable chart brushing.\n\t */\n\tenableBrush: function() {\n\t\tthis._chart._brushEnabled = true;\n\t},\n\n\t/**\n\t * Alias for enableBrush\n\t */\n\tenableDragging: function() {\n\t\tthis.enableBrushing();\n\t},\n\n\t/**\n\t * Alias for disableBrush\n\t */\n\tdisableDragging: function() {\n\t\tthis.disableBrushing();\n\t},\n\n\t/**\n\t * Disable chart zooming.\n\t */\n\tdisableZoom: function() {\n\t\tthis._chart._zoomEnabled = false;\n\t\tthis._chart._resetZoom();\n\t},\n\n\t/**\n\t * Enable chart zooming.\n\t */\n\tenableZoom: function() {\n\t\tthis._chart._zoomEnabled = true;\n\t},\n\n\t/**\n\t * Sets a map view that contains the given geographical bounds.\n\t */\n\tfitBounds: function(bounds) {\n\t\tbounds = bounds || this.getBounds();\n\t\tif (this._map && bounds.isValid()) this._map.fitBounds(bounds);\n\t},\n\n\tgetBounds: function(data) {\n\t\tdata = data || this._data;\n\t\treturn L.latLngBounds(data.map((d) => d.latlng));\n\t},\n\n\t/**\n\t * Get default zoom level when \"followMarker\" is true.\n\t */\n\tgetZFollow: function() {\n\t\treturn this._zFollow;\n\t},\n\n\t/**\n\t * Hide current elevation chart profile.\n\t */\n\thide: function() {\n\t\t_.style(this._container, \"display\", \"none\");\n\t},\n\n\t/**\n\t * Initialize chart control \"options\" and \"container\".\n\t */\n\tinitialize: function(options) {\n\t\tthis._data           = [];\n\t\tthis._layers         = L.featureGroup();\n\t\tthis._markedSegments = L.polyline([]);\n\t\tthis._chartEnabled   = true,\n\n\t\tthis.track_info      = {};\n\n\t\tthis.options         = _.deepMerge({}, this.options, options);\n\n\t\tthis._zFollow        = this.options.zFollow;\n\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\n\t\tif (this.options.placeholder)  this.options.loadData.lazy = this.options.loadData.defer = true;\n\n\t\tif (this.options.legend)       this.options.margins.bottom += 30;\n\n\t\tif (this.options.theme)        this.options.polylineSegments.className += ' ' + this.options.theme;\n\n\t\tthis._markedSegments.setStyle(this.options.polylineSegments);\n\n\t\t// this._resizeChart   = _.debounce(this._resizeChart,   300, this);\n\t\t// this._resizeChart = L.Util.throttle(this._resizeChart, 300, this);\n\n\t\t// if (L.Browser.mobile) {\n\t\t// \tthis._updateChart   = _.debounce(this._updateChart,   300, this);\n\t\t// \tthis._updateSummary = _.debounce(this._updateSummary, 300, this);\n\t\t// }\n\n\t\t// Leaflet canvas renderer colors\n\t\tL.extend(D3.Colors, this.options.colors || {});\n\t},\n\n\t/**\n\t * Alias for loadData\n\t */\n\tload: function(data, opts) {\n\t\tthis.loadData(data, opts);\n\t},\n\n\t/**\n\t * Alias for addTo\n\t */\n\tloadChart: function(map) {\n\t\tthis.addTo(map);\n\t},\n\n\t/**\n\t * Load elevation data (GPX, GeoJSON or KML).\n\t */\n\tloadData: function(data, opts) {\n\t\topts = L.extend({}, this.options.loadData, opts);\n\t\tif (opts.defer) {\n\t\t\tthis.loadDefer(data, opts);\n\t\t} else if (opts.lazy) {\n\t\t\tthis.loadLazy(data, opts);\n\t\t} else if (_.isXMLDoc(data)) {\n\t\t\tthis.loadXML(data);\n\t\t} else if (_.isJSONDoc(data)) {\n\t\t\tthis.loadGeoJSON(data);\n\t\t} else {\n\t\t\tthis.loadFile(data);\n\t\t}\n\t},\n\n\t/**\n\t * Wait for document load before download data.\n\t */\n\tloadDefer: function(data, opts) {\n\t\topts       = L.extend({}, this.options.loadData, opts);\n\t\topts.defer = false;\n\t\t_.deferFunc(L.bind(this.loadData, this, data, opts));\n\t},\n\n\t/**\n\t * Load data from a remote url.\n\t */\n\tloadFile: function(url) {\n\t\tfetch(url)\n\t\t\t.then((response) => response.text())\n\t\t\t.then((data)     => {\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\n\t\t\t\tthis.loadData(data, { lazy: false, defer: false });\n\t\t\t})\n\t\t\t.catch((err) => console.warn(err));\n\t},\n\n\t/**\n\t * Load raw GeoJSON data.\n\t */\n\tloadGeoJSON: function(data) {\n\t\t_.GeoJSONLoader(data, this);\n\t},\n\n\t/**\n\t * Alias for loadXML\n\t */\n\tloadGPX: function(data){\n\t\tthis.loadXML(data);\n\t},\n\n\t/**\n\t * Load raw XML data.\n\t */\n\tloadXML: function(data) {\n\t\tElevation._togeojsonLazyLoader = _.lazyLoader(\n\t\t\tthis.__TOGEOJSON,\n\t\t\ttypeof toGeoJSON !== 'function' || !this.options.lazyLoadJS,\n\t\t\tElevation._togeojsonLazyLoader\n\t\t).then(\n\t\t\t() => {\n\t\t\t\tlet xml     = (new DOMParser()).parseFromString(data, \"text/xml\");\n\t\t\t\tlet type    = xml.documentElement.tagName.toLowerCase(); // \"kml\" or \"gpx\"\n\t\t\t\tif (!(type in toGeoJSON)) {\n\t\t\t\t\ttype = xml.documentElement.tagName == \"TrainingCenterDatabase\" ? 'tcx' : 'gpx';\n\t\t\t\t}\n\t\t\t\tlet geojson = toGeoJSON[type](xml);\n\t\t\t\tlet name    = xml.getElementsByTagName('name');\n\t\t\t\tif(name[0]) { geojson.name = name[0].innerHTML; }\n\t\t\t\telse if(this._downloadURL) { geojson.name = this._downloadURL.split('/').pop().split('#')[0].split('?')[0]; }\n\n\t\t\t\treturn this.loadGeoJSON(geojson, this);\n\t\t\t}\n\t\t);\n\t},\n\n\t/**\n\t * Wait for chart container visible before download data.\n\t */\n\tloadLazy: function(data, opts) {\n\t\topts     = L.extend({}, this.options.loadData, opts);\n\t\tlet elem = opts.lazy.parentNode ? opts.lazy : this.placeholder;\n\t\t_.waitHolder(elem)\n\t\t\t.then(() => {\n\t\t\t\topts.lazy = false;\n\t\t\t\tthis.loadData(data, opts)\n\t\t\t\tthis.once('eledata_loaded', () => this.placeholder.parentNode.removeChild(elem));\n\t\t\t});\n\t},\n\n\t/**\n\t * Create container DOM element and related event listeners.\n\t * Called on control.addTo(map).\n\t */\n\tonAdd: function(map) {\n\t\tthis._map = map;\n\n\t\tlet container = this._container = _.create(\"div\", \"elevation-control elevation \" + this.options.theme);\n\n\t\tif (!this.options.detached) {\n\t\t\t_.addClass(container, 'leaflet-control');\n\t\t}\n\n\t\tif (this.options.placeholder && !this._data.length) {\n\t\t\tthis.placeholder = _.create('img', 'elevation-placeholder', typeof this.options.placeholder === 'string' ? { src: this.options.placeholder, alt: '' } : this.options.placeholder);\n\t\t\t_.insert(container, this.placeholder, 'afterbegin');\n\t\t}\n\n\t\tElevation._d3LazyLoader = _.lazyLoader(\n\t\t\tthis.__D3,\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\n\t\t\tElevation._d3LazyLoader\n\t\t).then(() => {\n\t\t\tthis._initButton(container);\n\t\t\tthis._initChart(container);\n\t\t\tthis._initSummary(container);\n\t\t\tthis._initMarker(map);\n\t\t\tthis._initLayer(map);\n\n\t\t\tmap\n\t\t\t\t.on('zoom viewreset zoomanim',       this._hideMarker,    this)\n\t\t\t\t.on('resize',                        this._resetView,     this)\n\t\t\t\t.on('resize',                        this._resizeChart,   this)\n\t\t\t\t.on('rotate',                        this._rotateMarker,  this)\n\t\t\t\t.on('mousedown',                     this._resetDrag,     this);\n\n\t\t\t_.on(map.getContainer(), 'mousewheel', this._resetDrag,     this);\n\t\t\t_.on(map.getContainer(), 'touchstart', this._resetDrag,     this);\n\n\t\t\tthis\n\t\t\t\t.on('eledata_added eledata_loaded',  this._updateChart,   this)\n\t\t\t\t.on('eledata_added eledata_loaded',  this._updateSummary, this);\n\n\t\t\tthis._updateChart();\n\t\t\tthis._updateSummary();\n\t\t});\n\n\t\treturn container;\n\t},\n\n\t/**\n\t * Clean up control code and related event listeners.\n\t * Called on control.remove().\n\t */\n\tonRemove: function(map) {\n\t\tthis._container = null;\n\n\t\tmap\n\t\t\t.off('zoom viewreset zoomanim',       this._hideMarker,    this)\n\t\t\t.off('resize',                        this._resetView,     this)\n\t\t\t.off('resize',                        this._resizeChart,   this)\n\t\t\t.off('mousedown',                     this._resetDrag,     this);\n\n\t\t_.off(map.getContainer(), 'mousewheel', this._resetDrag,     this);\n\t\t_.off(map.getContainer(), 'touchstart', this._resetDrag,     this);\n\n\t\tthis\n\t\t\t.off('eledata_added eledata_loaded',  this._updateChart,   this)\n\t\t\t.off('eledata_added eledata_loaded',  this._updateSummary, this);\n\t},\n\n\t/**\n\t * Redraws the chart control. Sometimes useful after screen resize.\n\t */\n\tredraw: function() {\n\t\tthis._resizeChart();\n\t},\n\n\t/**\n\t * Set default zoom level when \"followMarker\" is true.\n\t */\n\tsetZFollow: function(zoom) {\n\t\tthis._zFollow = zoom;\n\t},\n\n\t/**\n\t * Hide current elevation chart profile.\n\t */\n\tshow: function() {\n\t\t_.style(this._container, \"display\", \"block\");\n\t},\n\n\t/*\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\n\t */\n\t_addData: function(d) {\n\t\tif (!d) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet geom = d.geometry;\n\t\tif (geom) {\n\t\t\tswitch (geom.type) {\n\t\t\t\tcase 'LineString':\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'MultiLineString':\n\t\t\t\t\t_.each(geom.coordinates, coords => this._addGeoJSONData(coords));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\n\t\t\t}\n\t\t}\n\n\t\tif (d.type === \"FeatureCollection\") {\n\t\t\t_.each(d.features, feature => this._addData(feature));\n\t\t}\n\n\t\tif (d._latlngs) {\n\t\t\tthis._addGPXData(d._latlngs);\n\t\t}\n\t},\n\n\t/*\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\n\t */\n\t_addGeoJSONData: function(coords) {\n\t\t_.each(coords, point => {\n\t\t\tthis._addPoint(point[1], point[0], point[2]);\n\t\t\tthis._fireEvt(\"elepoint_added\", { point: point, index: this._data.length - 1 });\n\t\t});\n\t\tthis._fireEvt(\"eletrack_added\", { coords: coords, index: this._data.length - 1 });\n\t},\n\n\t/*\n\t * Parsing function for GPX data and their elevation in z-coordinate\n\t */\n\t_addGPXData: function(coords) {\n\t\t_.each(coords, point => {\n\t\t\tthis._addPoint(point.lat, point.lng, point.meta.ele);\n\t\t\tthis._fireEvt(\"elepoint_added\", { point: point, index: this._data.length - 1 });\n\t\t});\n\t\tthis._fireEvt(\"eletrack_added\", { coords: coords, index: this._data.length - 1 });\n\t},\n\n\t/*\n\t * Parse and push a single (x, y, z) point to current elevation profile.\n\t */\n\t_addPoint: function(x, y, z) {\n\t\tif (this.options.reverseCoords) {\n\t\t\t[x, y] = [y, x];\n\t\t}\n\n\t\tthis._data.push({\n\t\t\tx: x,\n\t\t\ty: y,\n\t\t\tz: z,\n\t\t\tlatlng: L.latLng(x, y, z)\n\t\t});\n\n\t\tthis._fireEvt(\"eledata_updated\", { index: this._data.length - 1 });\n\t},\n\n\t_addLayer: function(layer) {\n\t\tif (layer) this._layers.addLayer(layer)\n\t},\n\n\t/**\n\t * Adds the control to the given \"detached\" div.\n\t */\n\t_initElevationDiv: function() {\n\t\tlet eleDiv = _.select(this.options.elevationDiv);\n\t\tif (!eleDiv) {\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + _.randomId();\n\t\t\teleDiv                    = _.create('div', 'leaflet-control elevation elevation-div', { id: this.options.elevationDiv.substr(1) });\n\t\t}\n\t\tif (this.options.detached) {\n\t\t\t_.replaceClass(eleDiv, 'leaflet-control', 'elevation-detached');\n\t\t}\n\t\tthis.eleDiv = eleDiv;\n\t\treturn this.eleDiv;\n\t},\n\n\t/*\n\t * Collapse current chart control.\n\t */\n\t_collapse: function() {\n\t\t_.replaceClass(this._container, 'elevation-expanded', 'elevation-collapsed');\n\t},\n\n\t/*\n\t * Expand current chart control.\n\t */\n\t_expand: function() {\n\t\t_.replaceClass(this._container, 'elevation-collapsed', 'elevation-expanded');\n\t},\n\n\t/*\n\t * Finds a data entry for the given LatLng\n\t */\n\t_findItemForLatLng: function(latlng) {\n\t\treturn this._data[this._chart._findIndexForLatLng(latlng)];\n\t},\n\n\t/*\n\t * Finds a data entry for the given xDiagCoord\n\t */\n\t_findItemForX: function(x) {\n\t\treturn this._data[this._chart._findIndexForXCoord(x)];\n\t},\n\n\t/**\n\t * Fires an event of the specified type.\n\t */\n\t_fireEvt: function(type, data, propagate) {\n\t\tif (this.fire) this.fire(type, data, propagate);\n\t\tif (this._map) this._map.fire(type, data, propagate);\n\t},\n\n\t/**\n\t * Calculates chart height.\n\t */\n\t_height: function() {\n\t\tif (this._chart) return this._chart._height();\n\t\tlet opts = this.options;\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\n\t},\n\n\t/*\n\t * Hides the position/height indicator marker drawn onto the map\n\t */\n\t_hideMarker: function() {\n\t\tif (this.options.autohideMarker) {\n\t\t\tthis._marker.remove();\n\t\t}\n\t},\n\n\t/**\n\t * Generate \"svg\" chart DOM element.\n\t */\n\t_initChart: function(container) {\n\t\tlet opts    = this.options;\n\n\t\topts.xTicks = this._xTicks();\n\t\topts.yTicks = this._yTicks();\n\n\t\tif (opts.responsive) {\n\t\t\tif (opts.detached) {\n\t\t\t\tlet { offsetWidth, offsetHeight}             = this.eleDiv;\n\t\t\t\tif (offsetWidth > 0)             opts.width  = offsetWidth;\n\t\t\t\tif (offsetHeight > 20)           opts.height = offsetHeight - 20; // 20 = horizontal scrollbar size.\n\t\t\t} else {\n\t\t\t\tlet { clientWidth }                          = this._map.getContainer();\n\t\t\t\topts._maxWidth                               = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\n\t\t\t\tthis._container.style.maxWidth               = opts._maxWidth + 'px';\n\t\t\t\tif (opts._maxWidth > clientWidth) opts.width = clientWidth - 30;\n\t\t\t}\n\t\t}\n\n\t\tlet chart = this._chart = new Chart(opts, this);\n\n\t\tthis._x     = this._chart._x;\n\t\tthis._y     = this._chart._y;\n\n\t\td3\n\t\t\t.select(container)\n\t\t\t.call(chart.render())\n\n\t\tchart\n\t\t\t.on('reset_drag',     this._hideMarker,                     this)\n\t\t\t.on('mouse_enter',    this._fireEvt.bind('elechart_enter'), this)\n\t\t\t.on('dragged',        this._dragendHandler,                 this)\n\t\t\t.on('mouse_move',     this._mousemoveHandler,               this)\n\t\t\t.on('mouse_out',      this._mouseoutHandler,                this)\n\t\t\t.on('ruler_filter',   this._rulerFilterHandler,             this)\n\t\t\t.on('zoom',           this._updateChart,                    this)\n\t\t\t.on('elepath_toggle', this._toggleChartHandler,             this)\n\t\t\t.on('margins_updated',this._resizeChart,                    this);\n\n\n\t\tthis._fireEvt(\"elechart_axis\");\n\t\tif (this.options.legend) this._fireEvt(\"elechart_legend\");\n\n\t\tthis._fireEvt(\"elechart_init\");\n\t},\n\n\t_initLayer: function() {\n\t\tthis._layers\n\t\t\t.on('layeradd layerremove', (e) => {\n\t\t\t\tlet layer = e.layer\n\t\t\t\tlet node  = layer.getElement && layer.getElement();\n\t\t\t\t_.toggleClass(node,  this.options.polyline.className + ' ' + this.options.theme, e.type == 'layeradd');\n\t\t\t\t_.toggleEvent(layer, \"mousemove\", this._mousemoveLayerHandler.bind(this),        e.type == 'layeradd')\n\t\t\t\t_.toggleEvent(layer, \"mouseout\",  this._mouseoutHandler.bind(this),              e.type == 'layeradd');\n\t\t\t});\n\t},\n\n\t_initMarker: function(map) {\n\t\tlet pane                   = map.getPane('elevationPane');\n\t\tif (!pane) {\n\t\t\tpane = this._pane        = map.createPane('elevationPane', map.getPane('norotatePane') || map.getPane('mapPane'));\n\t\t\tpane.style.zIndex        = 625; // This pane is above markers but below popups.\n\t\t\tpane.style.pointerEvents = 'none';\n\t\t}\n\n\t\tif (this._renderer) this._renderer.remove()\n\t\tthis._renderer             = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\n\t\tthis._marker               = new Marker(this.options);\n\n\t\tthis._fireEvt(\"elechart_marker\");\n\t},\n\n\t/**\n\t * Inspired by L.Control.Layers\n\t */\n\t_initButton: function(container) {\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\n\t\tcontainer.setAttribute('aria-haspopup', true);\n\n\t\tif (!this.options.detached) {\n\t\t\tL.DomEvent\n\t\t\t\t.disableClickPropagation(container);\n\t\t\t//.disableScrollPropagation(container);\n\t\t}\n\n\t\tif (L.Browser.mobile) {\n\t\t\t_.on(container, 'click', L.DomEvent.stopPropagation);\n\t\t}\n\n\t\t_.on(container, 'mousewheel', this._mousewheelHandler, this);\n\n\t\tif (!this.options.detached) {\n\t\t\tlet link = this._button = _.create('a', \"elevation-toggle elevation-toggle-icon\" + (this.options.autohide ? \"\" : \" close-button\"), { href: '#', title: L._('Elevation') }, container);\n\n\t\t\tif (this.options.collapsed) {\n\t\t\t\tthis._collapse();\n\t\t\t\tif (this.options.autohide) {\n\t\t\t\t\t_.on(container, 'mouseover', this._expand,   this);\n\t\t\t\t\t_.on(container, 'mouseout',  this._collapse, this);\n\t\t\t\t} else {\n\t\t\t\t\t_.on(link, 'click', L.DomEvent.stop);\n\t\t\t\t\t_.on(link, 'click', this._toggle, this);\n\t\t\t\t}\n\n\t\t\t\t_.on(link, 'focus', this._toggle, this);\n\n\t\t\t\tthis._map.on('click', this._collapse, this);\n\t\t\t\t// TODO: keyboard accessibility\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO: handle autohide when detached=true\n\t\t}\n\t},\n\n\t_initSummary: function(container) {\n\t\tlet summary = this._summary = new Summary({ summary: this.options.summary }, this);\n\n\t\td3\n\t\t\t.select(container)\n\t\t\t.call(summary.render());\n\n\t\tthis.summaryDiv = this._summary._container;\n\t},\n\n\t_dragendHandler: function(e) {\n\t\tthis._hideMarker();\n\t\tthis.fitBounds(L.latLngBounds([e.dragstart.latlng, e.dragend.latlng]));\n\n\t\tthis._fireEvt(\"elechart_dragged\");\n\t},\n\n\t/*\n\t * Handles the moueseover the chart and displays distance and altitude level.\n\t */\n\t_mousemoveHandler: function(e) {\n\t\tif (!this._data.length || !this._chartEnabled) {\n\t\t\treturn;\n\t\t}\n\t\tlet item = this._findItemForX(e.xCoord);\n\n\t\tif (item) {\n\t\t\tlet xCoord = e.xCoord;\n\n\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\n\n\t\t\tthis._updateMarker(item);\n\t\t\tthis._setMapView(item);\n\n\t\t\tif (this._map) {\n\t\t\t\t_.addClass(this._map.getContainer(), 'elechart-hover');\n\t\t\t}\n\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\n\t\t\tthis._fireEvt(\"elechart_hover\",  { data: item, xCoord: xCoord });\n\t\t}\n\t},\n\n\t/*\n\t * Handles mouseover events of the data layers on the map.\n\t */\n\t_mousemoveLayerHandler: function(e) {\n\t\tif (!this._data.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet item = this._findItemForLatLng(e.latlng);\n\t\tif (item) {\n\t\t\tlet xCoord = item.xDiagCoord;\n\n\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\n\n\t\t\tthis._updateMarker(item);\n\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\n\t\t}\n\t},\n\n\t/*\n\t * Handles the moueseout over the chart.\n\t */\n\t_mouseoutHandler: function() {\n\t\tif (!this.options.detached) {\n\t\t\tthis._hideMarker();\n\t\t\tthis._chart._hideDiagramIndicator();\n\t\t}\n\n\t\tif (this._map) {\n\t\t\t_.removeClass(this._map.getContainer(), 'elechart-hover');\n\t\t}\n\n\t\tthis._fireEvt(\"elechart_leave\");\n\t},\n\n\t/*\n\t * Handles the mouesewheel over the chart.\n\t */\n\t_mousewheelHandler: function(e) {\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\n\t\tlet ll = this._marker.getLatLng() || this._map.getCenter();\n\t\tlet z  = this._map.getZoom() + Math.sign(e.deltaY);\n\t\tthis._resetDrag();\n\t\tthis._map.flyTo(ll, z);\n\t},\n\n\t/**\n\t * Add a waypoint marker to the diagram\n\t */\n\t_registerCheckPoint: function(props) {\n\t\tthis.on(\"elechart_updated\", () => this._chart._registerCheckPoint(props));\n\t},\n\n\t/**\n\t * Add chart profile to diagram\n\t */\n\t_registerAreaPath: function(props) {\n\t\tthis.on(\"elechart_init\", () => this._chart._registerAreaPath(props));\n\t},\n\n\t/**\n\t * Add chart grid to diagram\n\t */\n\t_registerAxisGrid: function(props) {\n\t\tthis.on(\"elechart_axis\", () => this._chart._registerAxisGrid(props));\n\t},\n\n\t/**\n\t * Add chart axis to diagram\n\t */\n\t_registerAxisScale: function(props) {\n\t\tthis.on(\"elechart_axis\", () => this._chart._registerAxisScale(props));\n\t},\n\n\t/**\n\t * Add chart or marker tooltip info\n\t */\n\t_registerFocusLabel: function(props) {\n\t\tif (props.chart) {\n\t\t\tlet label = L.extend({}, props, { value: props.chart });\n\t\t\tthis.on(\"elechart_init\",   () => this._chart._registerFocusLabel(label));\n\t\t}\n\t\tif (props.marker) {\n\t\t\tlet label = L.extend({}, props, { value: props.marker });\n\t\t\tthis.on(\"elechart_marker\", () => this._marker._registerFocusLabel(label));\n\t\t}\n\t},\n\n\t/**\n\t * Add summary info to diagram\n\t */\n\t_registerSummary: function(props) {\n\t\tthis.on('elechart_summary',  () => this._summary._registerSummary(props));\n\t},\n\n\t/*\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\n\t */\n\t_resetDrag: function() {\n\t\tthis._chart._resetDrag();\n\t\tthis._hideMarker();\n\t},\n\n\t/**\n\t * Resets drag, marker and bounds.\n\t */\n\t_resetView: function() {\n\t\tif (this._map && this._map._isFullscreen) return;\n\t\tthis._resetDrag();\n\t\tthis._hideMarker();\n\t\tif (this.options.autofitBounds) {\n\t\t\tthis.fitBounds();\n\t\t}\n\t},\n\n\t/**\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\n\t */\n\t_resizeChart: function() {\n\t\t// prevent displaying chart on resize if hidden\n\t\tif (_.style(this._container, \"display\") == \"none\") return;\n\n\t\tlet opts = this.options;\n\n\t\tif (opts.responsive) {\n\t\t\tlet newWidth;\n\t\t\tif (opts.detached) {\n\t\t\t\tnewWidth = (this.eleDiv || this._container).offsetWidth;\n\t\t\t} else {\n\t\t\t\tlet { clientWidth } = this._map.getContainer();\n\t\t\t\tnewWidth = opts._maxWidth > clientWidth ? clientWidth - 30 : opts._maxWidth;\n\t\t\t}\n\t\t\tif (newWidth) {\n\t\t\t\tlet chart  = this._chart;\n\t\t\t\topts.width = newWidth;\n\t\t\t\tif (chart && chart._chart) {\n\t\t\t\t\tchart._chart._resize(opts);\n\t\t\t\t\topts.xTicks = this._xTicks();\n\t\t\t\t\topts.yTicks = this._yTicks();\n\t\t\t\t\tthis._updateChart();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._updateMapSegments();\n\t},\n\n\t/**\n\t * Handles the drag event over the ruler filter.\n\t */\n\t_rulerFilterHandler: function(e) {\n\t\tthis._updateMapSegments(e.coords);\n\t},\n\n\t/**\n\t * Collapse or Expand current chart control.\n\t */\n\t_toggle: function() {\n\t\tif (_.hasClass(this._container, \"elevation-expanded\"))\n\t\t\tthis._collapse();\n\t\telse\n\t\t\tthis._expand();\n\t},\n\n\t/**\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\n\t */\n\t_setMapView: function(item) {\n\t\tif (!this.options.followMarker || !this._map) return;\n\t\tlet zoom = this._map.getZoom();\n\t\tif (\"number\" === typeof this._zFollow) {\n\t\t\tif (zoom < this._zFollow) zoom = this._zFollow;\n\t\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\n\t\t} else if (!this._map.getBounds().contains(item.latlng)) {\n\t\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\n\t\t}\n\t},\n\n\t/**\n\t * Toggle chart data on legend click\n\t */\n\t_toggleChartHandler: function(e) {\n\t\tlet { path, name, enabled } = e;\n\n\t\tthis._chartEnabled = this._chart._hasActiveLayers();\n\n\t\t// toggle layer visibility on empty chart\n\t\tthis._layers.eachLayer(layer => {\n\t\t\tlet node = layer.getElement && layer.getElement();\n\t\t\t_.toggleClass(node, this.options.polyline.className + ' ' + this.options.theme, this._chartEnabled);\n\t\t\t}\n\t\t);\n\n\t\t// toggle option value (eg. altitude = { 'disabled' || 'disabled' })\n\t\tthis.options[name] = !enabled && this.options[name] == 'disabled' ? 'enabled' : 'disabled';\n\n\t\t// remove marker on empty chart\n\t\tif (!this._chartEnabled) {\n\t\t\tthis._chart._hideDiagramIndicator();\n\t\t\tthis._marker.remove();\n\t\t}\n\t},\n\n\t/**\n\t * Calculates [x, y] domain and then update chart.\n\t */\n\t_updateChart: function() {\n\t\tif (!this._data.length || !this._container) return;\n\n\t\tthis._fireEvt(\"elechart_axis\");\n\t\tthis._fireEvt(\"elechart_area\");\n\n\t\tthis._chart.update({ data: this._data, options: this.options });\n\n\t\tthis._x     = this._chart._x;\n\t\tthis._y     = this._chart._y;\n\n\t\tthis._fireEvt('elechart_updated');\n\t},\n\n\t/*\n\t * Update the position/height indicator marker drawn onto the map\n\t */\n\t_updateMarker: function(item) {\n\t\tif (!this._marker) return;\n\t\tthis._marker.update({\n\t\t\tmap         : this._map,\n\t\t\titem        : item,\n\t\t\tmaxElevation: this.track_info.elevation_max || 0,\n\t\t\toptions     : this.options\n\t\t});\n\t},\n\n\t/**\n\t * Fix marker rotation on rotated maps\n\t */\n\t_rotateMarker: function() {\n\t\tif (!this._marker) return;\n\t\tthis._marker.update();\n\t},\n\n\t/**\n\t * Highlight track segments on the map.\n\t */\n\t_updateMapSegments: function(coords) {\n\t\tthis._markedSegments.setLatLngs(coords || []);\n\t\tif (coords && this._map && !this._map.hasLayer(this._markedSegments)) {\n\t\t\tthis._markedSegments.addTo(this._map);\n\t\t}\n\t},\n\n\t/**\n\t * Update chart summary.\n\t */\n\t_updateSummary: function() {\n\t\tthis._summary.reset();\n\n\t\tif (this.options.summary) {\n\t\t\tthis._fireEvt(\"elechart_summary\");\n\t\t}\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\n\t\t\t_.select('.download a', this.summaryDiv).onclick = (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis._fireEvt('eletrack_download', { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this, this._downloadURL) });\n\t\t\t};\n\t\t};\n\t},\n\n\n\t/**\n\t * Calculates chart width.\n\t */\n\t_width: function() {\n\t\tif (this._chart) return this._chart._width();\n\t\tlet opts = this.options;\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\n\t},\n\n\t/**\n\t * Calculate chart xTicks\n\t */\n\t_xTicks: function() {\n\t\tif (this.__xTicks) this.__xTicks = this.options.xTicks;\n\t\treturn this.__xTicks || Math.round(this._width() / 75);\n\t},\n\n\t/**\n\t * Calculate chart yTicks\n\t */\n\t_yTicks: function() {\n\t\tif (this.__yTicks) this.__yTicks = this.options.yTicks;\n\t\treturn this.__yTicks || Math.round(this._height() / 30);\n\t}\n\n});\n\n/**\n * Attach here some useful elevation hooks.\n */\nElevation.addInitHook(function() {\n\n\tthis.on('waypoint_added', function(e) {\n\t\tlet p = e.point,\n\t\t\tpop = p._popup;\n\t\tif (pop) {\n\t\t\tpop.options.className = 'elevation-popup';\n\t\t}\n\t\tif (pop && pop._content) {\n\t\t\tpop._content = decodeURI(pop._content);\n\t\t\tp.bindTooltip(pop._content, { direction: 'auto', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\n\t\t}\n\t});\n\n\tthis.on(\"eletrack_download\", function(e) {\n\t\tif (e.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\n\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: e }));\n\t\t} else if (e.downloadLink == 'link' || e.downloadLink === true) {\n\t\t\te.confirm();\n\t\t}\n\t});\n\n\tthis.on('eledata_loaded', function(e) {\n\t\tlet map   = this._map;\n\t\tlet layer = e.layer;\n\t\tif (!map) {\n\t\t\tconsole.warn(\"Undefined elevation map object\");\n\t\t\treturn;\n\t\t}\n\t\tmap.once('layeradd',   (e) => this.options.autofitBounds && this.fitBounds(layer.getBounds()));\n\n\t\tif (L.Browser.mobile) {\n\n\t\t\tif (this.options.polyline) layer.addTo(map);\n\n\t\t} else {\n\n\t\t\t// leaflet-geometryutil\n\t\t\tElevation._geomutilLazyLoader = _.lazyLoader(\n\t\t\t\tthis.__LGEOMUTIL,\n\t\t\t\ttypeof L.GeometryUtil !== 'function' || !this.options.lazyLoadJS,\n\t\t\t\tElevation._geomutilLazyLoader\n\t\t\t).then(\n\t\t\t\t() => {\n\n\t\t\t\t\t// leaflet-almostover\n\t\t\t\t\tif (this.options.almostOver) {\n\t\t\t\t\t\tElevation._almostoverLazyLoader = _.lazyLoader(\n\t\t\t\t\t\t\tthis.__LALMOSTOVER,\n\t\t\t\t\t\t\ttypeof L.Handler.AlmostOver  !== 'function' || !this.options.lazyLoadJS,\n\t\t\t\t\t\t\tElevation._almostoverLazyLoader\n\t\t\t\t\t\t).then(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tmap.addHandler('almostOver',L.Handler.AlmostOver)\n\t\t\t\t\t\t\t\tif (L.GeometryUtil && map.almostOver && map.almostOver.enabled()) {\n\t\t\t\t\t\t\t\t\tmap.almostOver.addLayer(layer);\n\t\t\t\t\t\t\t\t\tmap\n\t\t\t\t\t\t\t\t\t\t.on('almost:move', (e) => this._mousemoveLayerHandler(e))\n\t\t\t\t\t\t\t\t\t\t.on('almost:out',  (e) => this._mouseoutHandler(e));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// leaflet-distance-markers\n\t\t\t\t\tif (this.options.distanceMarkers) {\n\t\t\t\t\t\tElevation._distanceMarkersLazyLoader = _.lazyLoader(\n\t\t\t\t\t\t\tthis.__LDISTANCEM,\n\t\t\t\t\t\t\ttypeof L.DistanceMarkers  !== 'function' || !this.options.lazyLoadJS,\n\t\t\t\t\t\t\tElevation._distanceMarkersLazyLoader\n\t\t\t\t\t\t).then(() => this.options.polyline && layer.addTo(map));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (this.options.polyline) layer.addTo(map);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t);\n\t\t}\n\t});\n\n\t// Basic canvas renderer support.\n\tlet oldProto = L.Canvas.prototype._fillStroke;\n\tlet control  = this;\n\tL.Canvas.include({\n\t\t_fillStroke: function(ctx, layer) {\n\t\t\tif (control._layers.hasLayer(layer)) {\n\n\t\t\t\tlet theme      = control.options.theme.replace('-theme', '');\n\t\t\t\tlet color      = D3.Colors[theme] || {};\n\t\t\t\tlet options    = layer.options;\n\n\t\t\t\toptions.color  = color.line || color.area || theme;\n\t\t\t\toptions.stroke = !!options.color;\n\n\t\t\t\toldProto.call(this, ctx, layer);\n\n\t\t\t\tif (options.stroke && options.weight !== 0) {\n\t\t\t\t\tlet oldVal                   = ctx.globalCompositeOperation || 'source-over';\n\t\t\t\t\tctx.globalCompositeOperation = 'destination-over'\n\t\t\t\t\tctx.strokeStyle              = '#FFF';\n\t\t\t\t\tctx.lineWidth                = options.weight * 1.75;\n\t\t\t\t\tctx.stroke();\n\t\t\t\t\tctx.globalCompositeOperation = oldVal;\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\toldProto.call(this, ctx, layer);\n\t\t\t}\n\t\t}\n\t});\n\n\t// Partially fix: https://github.com/Raruto/leaflet-elevation/issues/81#issuecomment-713477050\n\tthis.on('elechart_init', function() {\n\t\tthis.once('elechart_change elechart_hover', function(e) {\n\t\t\tif (this._chartEnabled) {\n\t\t\t\tthis._chart._showDiagramIndicator(e.data, e.xCoord);\n\t\t\t\tthis._chart._showDiagramIndicator(e.data, e.xCoord);\n\t\t\t}\n\t\t\tthis._updateMarker(e.data);\n\t\t});\n\t});\n\n});\n","import 'leaflet-i18n';\nimport * as _        from './utils';\nimport * as D3       from './components';\nimport { Elevation } from './control';\n\nElevation.addInitHook(function() {\n\n\tlet opts     = this.options;\n\tlet distance = {};\n\n\tif (this.options.imperial) {\n\t\tthis._distanceFactor = this.__mileFactor;\n\t\tthis._xLabel         = \"mi\";\n\t} else {\n\t\tthis._distanceFactor = opts.distanceFactor;\n\t\tthis._xLabel         = opts.xLabel;\n\t}\n\n\tthis.on(\"eledata_updated\", function(e) {\n\t\tlet data = this._data;\n\t\tlet i    = e.index;\n\n\t\tlet track = this.track_info;\n\t\tlet dist  = track.distance || 0;\n\n\t\tlet curr = data[i].latlng;\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\n\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\n\n\t\tdist += Math.round(delta / 1000 * 100000) / 100000; // handles floating points calc\n\n\t\tdata[i].dist = dist;\n\n\t\ttrack.distance = dist;\n\t});\n\n\tthis.on(\"elechart_axis\", function() {\n\n\t\tthis._chart._registerAxisGrid({\n\t\t\taxis      : \"x\",\n\t\t\tposition  : \"bottom\",\n\t\t\tscale     : this._chart._x,\n\t\t});\n\n\t});\n\n\tif (this.options.distance != \"summary\") {\n\n\t\tthis.on(\"elechart_axis\", function() {\n\n\t\t\tdistance.x     = this._chart._x;\n\t\t\tdistance.label = this._chart._xLabel;\n\n\t\t\tthis._chart._registerAxisScale({\n\t\t\t\taxis    : \"x\",\n\t\t\t\tposition: \"bottom\",\n\t\t\t\tscale   : distance.x,\n\t\t\t\tlabel   : distance.label,\n\t\t\t\tlabelY  : 25,\n\t\t\t\tlabelX  : () => this._width() + 6,\n\t\t\t\tname    : \"distance\",\n\t\t\t});\n\n\t\t});\n\n\t}\n\n\tthis._registerSummary({\n\t\t\"totlen\"  : {\n\t\t\tlabel: \"Total Length: \",\n\t\t\tvalue: (track) => (track.distance || 0).toFixed(2) + '&nbsp;' + this._xLabel\n\t\t}\n\t});\n\n});\n","import 'leaflet-i18n';\nimport * as _        from './utils';\nimport * as D3       from './components';\nimport { Elevation } from './control';\n\nElevation.addInitHook(function() {\n\n\tlet opts     = this.options;\n\tlet altitude = {};\n\n\tif (opts.imperial) {\n\t\tthis._heightFactor = this.__footFactor;\n\t\tthis._yLabel       = \"ft\";\n\t} else {\n\t\tthis._heightFactor = opts.heightFactor;\n\t\tthis._yLabel       = opts.yLabel;\n\t}\n\n\tthis.on(\"eledata_updated\", function(e) {\n\t\tlet data   = this._data;\n\t\tlet i      = e.index;\n\t\tlet z      = data[i].z * this._heightFactor;\n\n\t\tlet track  = this.track_info;\n\t\tlet eleMax = track.elevation_max || -Infinity;\n\t\tlet eleMin = track.elevation_min || +Infinity;\n\n\t\t// check and fix missing elevation data on last added point\n\t\tif (!this.options.skipNullZCoords && i > 0) {\n\t\t\tlet prevZ = data[i - 1].z;\n\t\t\tif (isNaN(prevZ)) {\n\t\t\t\tlet lastZ = this._lastValidZ;\n\t\t\t\tlet currZ = z;\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\n\t\t\t\t\tprevZ   = (lastZ + currZ) / 2;\n\t\t\t\t} else if (!isNaN(lastZ)) {\n\t\t\t\t\tprevZ   = lastZ;\n\t\t\t\t} else if (!isNaN(currZ)) {\n\t\t\t\t\tprevZ   = currZ;\n\t\t\t\t}\n\t\t\t\tif (!isNaN(prevZ)) return data.splice(i - 1, 1);\n\t\t\t\tdata[i - 1].z = prevZ;\n\t\t\t}\n\t\t}\n\t\t// skip point if it has not elevation\n\t\tif (!isNaN(z)) {\n\t\t\teleMax = eleMax < z ? z : eleMax;\n\t\t\teleMin = eleMin > z ? z : eleMin;\n\t\t\tthis._lastValidZ = z;\n\t\t}\n\n\t\tdata[i].z = z;\n\n\t\ttrack.elevation_max = eleMax;\n\t\ttrack.elevation_min = eleMin;\n\t});\n\n\tthis.on(\"elechart_axis\", function() {\n\n\t\tthis._chart._registerAxisGrid({\n\t\t\taxis      : \"y\",\n\t\t\tposition  : \"left\",\n\t\t\tscale     : this._chart._y,\n\t\t});\n\n\t});\n\n\tif (this.options.altitude != \"summary\") {\n\n\t\tthis.on(\"elechart_axis\", function() {\n\n\t\t\taltitude.y     = this._chart._y;\n\t\t\taltitude.label = this._yLabel;\n\n\t\t\tthis._chart._registerAxisScale({\n\t\t\t\taxis    : \"y\",\n\t\t\t\tposition: \"left\",\n\t\t\t\tscale   : altitude.y,\n\t\t\t\tlabel   : altitude.label,\n\t\t\t\tlabelX  : -3,\n\t\t\t\tlabelY  : -8,\n\t\t\t\tname    : \"altitude\",\n\t\t\t});\n\n\t\t});\n\n\t\tthis.on(\"elechart_init\", function() {\n\n\t\t\tlet theme      = this.options.theme.replace('-theme', '');\n\t\t\tlet color      = D3.Colors[theme] || {};\n\t\t\tlet alpha      = (this.options.detached ? (color.alpha || '0.8') : 1);\n\t\t\tlet stroke     = (this.options.detached ? color.stroke : false);\n\n\t\t\tthis._chart._registerAreaPath({\n\t\t\t\tname         : 'altitude',\n\t\t\t\tlabel        : 'Altitude',\n\t\t\t\tscaleX       : 'distance',\n\t\t\t\tscaleY       : 'altitude',\n\t\t\t\tcolor        : color.area || theme,\n\t\t\t\tstrokeColor  : stroke || '#000',\n\t\t\t\tstrokeOpacity: \"1\",\n\t\t\t\tfillOpacity  : alpha,\n\t\t\t\tpreferCanvas : this.options.preferCanvas,\n\t\t\t});\n\n\t\t});\n\n\t}\n\n\tthis._registerSummary({\n\t\t\"maxele\"  : {\n\t\t\tlabel: \"Max Elevation: \",\n\t\t\tvalue: (track) => (track.elevation_max || 0).toFixed(2) + '&nbsp;' + this._yLabel\n\t\t},\n\t\t\"minele\"  : {\n\t\t\tlabel: \"Min Elevation: \",\n\t\t\tvalue: (track) => (track.elevation_min || 0).toFixed(2) + '&nbsp;' + this._yLabel\n\t\t},\n\t});\n\n});\n","import 'leaflet-i18n';\nimport * as _        from './utils';\nimport * as D3       from './components';\nimport { Elevation } from './control';\n\nElevation.addInitHook(function() {\n\n\tlet opts = this.options;\n\tlet time = {};\n\n\ttime.label       = opts.timeLabel  || 't';\n\tthis._timeFactor = opts.timeFactor;\n\n\t/**\n\t * Common AVG speeds:\n\t * ----------------------\n\t *  slow walk = 1.8  km/h\n\t *  walking   = 3.6  km/h\n\t *  running   = 10.8 km/h\n\t *  cycling   = 18   km/h\n\t *  driving   = 72   km/h\n\t * ----------------------\n\t */\n\tthis._timeAVGSpeed = (opts.timeAVGSpeed || 3.6) * (opts.speedFactor || 1);\n\n\tif (!opts.timeFormat) {\n\t\topts.timeFormat = (time) => (new Date(time)).toLocaleString().replaceAll('/', '-').replaceAll(',', ' ');\n\t} else if (opts.timeFormat == 'time') {\n\t\topts.timeFormat = (time) => (new Date(time)).toLocaleTimeString();\n\t} else if (opts.timeFormat == 'date') {\n\t\topts.timeFormat = (time) => (new Date(time)).toLocaleDateString();\n\t}\n\n\topts.xTimeFormat = opts.xTimeFormat || ((t) => _.formatTime(t).split(\"'\")[0]);\n\n\tif (opts.time && opts.time != \"summary\" && !L.Browser.mobile) {\n\n\t\tthis._registerAxisScale({\n\t\t\taxis       : \"x\",\n\t\t\tposition   : \"top\",\n\t\t\tscale      : {\n\t\t\t\tattr       : \"duration\",\n\t\t\t\tmin        : 0,\n\t\t\t},\n\t\t\tlabel      : time.label,\n\t\t\tlabelY     : -10,\n\t\t\tlabelX     : () => this._width(),\n\t\t\tname       : \"time\",\n\t\t\ttickFormat : (d)  => (d == 0 ? '' : opts.xTimeFormat(d)),\n\t\t\tonAxisMount: axis => {\n\t\t\t\taxis.select(\".domain\")\n\t\t\t\t\t.remove();\n\t\t\t\taxis.selectAll(\"text\")\n\t\t\t\t\t.attr('opacity', 0.65)\n\t\t\t\t\t.style('font-family', 'Monospace')\n\t\t\t\t\t.style('font-size', '110%');\n\t\t\t\taxis.selectAll(\".tick line\")\n\t\t\t\t\t.attr('y2', this._height())\n\t\t\t\t\t.attr('stroke-dasharray', 2)\n\t\t\t\t\t.attr('opacity', 0.75);\n\t\t\t\t}\n\t\t});\n\n\t}\n\n\tthis.on('elepoint_added', function(e) {\n\t\tlet data = this._data;\n\t\tlet i    = e.index;\n\n\t\t// Add missing timestamps (see: options.timeAVGSpeed)\n\t\tif (!e.point.meta || !e.point.meta.time) {\n\t\t\te.point.meta = e.point.meta || {};\n\t\t\tlet delta = (data[i].dist - data[i > 0 ? i - 1 : i].dist);\n\t\t\tlet speed = this._timeAVGSpeed;\n\t\t\te.point.meta.time = new Date(\n\t\t\t\t(\n\t\t\t\t\ti > 0\n\t\t\t\t\t\t? data[i - 1].time.getTime() + ((( delta / speed) * this._timeFactor) * 1000)\n\t\t\t\t\t\t: Date.now()\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tlet time = e.point.meta.time;\n\n\t\t// Handle timezone offset\n\t\tif (time.getTime() - time.getTimezoneOffset() * 60 * 1000 === 0) {\n\t\t\ttime = 0;\n\t\t}\n\n\t\tlet currT    = time;\n\t\tlet prevT    = i > 0 ? data[i - 1].time : currT;\n\n\t\tlet deltaT   = Math.abs(currT - prevT);\n\t\tlet duration = (this.track_info.time || 0) + deltaT;\n\n\t\tdata[i].time         = time;\n\t\tdata[i].duration     = duration;\n\n\t\tthis.track_info.time = duration;\n\t});\n\n\tif (this.options.time) {\n\n\t\tthis._registerFocusLabel({\n\t\t\tname: 'time',\n\t\t\tchart: (item) => this.options.timeFormat(item.time)\n\t\t});\n\n\t\tthis._registerSummary({\n\t\t\t\"tottime\"  : {\n\t\t\t\tlabel: \"Total Time: \",\n\t\t\t\tvalue: (track) => _.formatTime(track.time || 0)\n\t\t\t}\n\t\t});\n\n\t}\n\n});\n","import 'leaflet-i18n';\nimport * as _        from './utils';\nimport * as D3       from './components';\nimport { Elevation } from './control';\n\nElevation.addInitHook(function() {\n\n\tif (!this.options.slope) return;\n\n\tlet opts  = this.options;\n\tlet slope = {};\n\n\tslope.label          = opts.slopeLabel || '%';\n\n\tif (this.options.slope != \"summary\") {\n\n\t\tthis._registerAxisScale({\n\t\t\taxis       : \"y\",\n\t\t\tposition   : \"right\",\n\t\t\tscale      : {\n\t\t\t\tmin        : -1,\n\t\t\t\tmax        : +1,\n\t\t\t},\n\t\t\ttickPadding: 16,\n\t\t\tlabel      : slope.label,\n\t\t\tlabelX     : 25,\n\t\t\tlabelY     : -8,\n\t\t\tname       : 'slope'\n\t\t});\n\n\t\tthis._registerAreaPath({\n\t\t\tname         : 'slope',\n\t\t\tlabel        : 'Slope',\n\t\t\tyAttr        : 'slope',\n\t\t\tscaleX       : 'distance',\n\t\t\tscaleY       : 'slope',\n\t\t\tcolor        : '#F00',\n\t\t\tstrokeColor  : '#000',\n\t\t\tstrokeOpacity: \"0.5\",\n\t\t\tfillOpacity  : \"0.25\",\n\t\t});\n\n\t}\n\n\tthis.on(\"eledata_updated\", function(e) {\n\t\tlet data  = this._data;\n\t\tlet i     = e.index;\n\t\tlet z     = data[i].z;\n\t\tlet delta = (data[i].dist - data[i > 0 ? i - 1 : i].dist) * 1000;\n\n\t\t// Slope / Gain\n\t\tlet track = this.track_info;\n\t\tlet tAsc  = track.ascent    || 0; // Total Ascent\n\t\tlet tDes  = track.descent   || 0; // Total Descent\n\t\tlet sMax  = track.slope_max || 0; // Slope Max\n\t\tlet sMin  = track.slope_min || 0; // Slope Min\n\t\tlet slope = 0;\n\n\t\tif (!isNaN(z)) {\n\t\t\tlet deltaZ  = i > 0 ? z - data[i - 1].z : 0;\n\t\t\tif (deltaZ > 0)      tAsc += deltaZ;\n\t\t\telse if (deltaZ < 0) tDes -= deltaZ;\n\t\t\t// slope in % = ( height / length ) * 100\n\t\t\tif (delta !== 0)     slope = (deltaZ / delta) * 100;\n\t\t}\n\n\t\t// Try to smooth \"crazy\" slope values.\n\t\tif (this.options.sDeltaMax) {\n\t\t\tlet deltaS    = i > 0 ? slope - data[i - 1].slope : 0;\n\t\t\tlet maxDeltaS = this.options.sDeltaMax;\n\t\t\tif (Math.abs(deltaS) > maxDeltaS) {\n\t\t\t\tslope       = data[i - 1].slope + maxDeltaS * Math.sign(deltaS);\n\t\t\t}\n\t\t}\n\n\t\t// Range of acceptable slope values.\n\t\tif (this.options.sRange) {\n\t\t\tlet range = this.options.sRange;\n\t\t\tif (slope < range[0])      slope = range[0];\n\t\t\telse if (slope > range[1]) slope = range[1];\n\t\t}\n\n\t\tslope = L.Util.formatNum(slope, 2);\n\n\t\tif (slope > sMax) sMax = slope;\n\t\tif (slope < sMin) sMin = slope;\n\n\t\tdata[i].slope   = slope;\n\n\t\ttrack.ascent    = tAsc;\n\t\ttrack.descent   = tDes;\n\t\ttrack.slope_max = sMax;\n\t\ttrack.slope_min = sMin;\n\t});\n\n\tthis._registerFocusLabel({\n\t\tname: 'slope',\n\t\tchart: (item) => item.slope + slope.label,\n\t\tmarker: (item) => Math.round(item.slope) + slope.label\n\t});\n\n\tthis._registerSummary({\n\t\t\"ascent\"  : {\n\t\t\tlabel: \"Total Ascent: \",\n\t\t\tvalue: (track) => Math.round(track.ascent || 0) + '&nbsp;' + this._yLabel\n\t\t},\n\t\t\"descent\"  : {\n\t\t\tlabel: \"Total Descent: \",\n\t\t\tvalue: (track) => Math.round(track.descent || 0) + '&nbsp;' + this._yLabel\n\t\t},\n\t\t\"minslope\": {\n\t\t\tlabel: \"Min Slope: \",\n\t\t\tvalue: (track) => Math.round(track.slope_min || 0) + '&nbsp;' + slope.label\n\t\t},\n\t\t\"maxslope\": {\n\t\t\tlabel: \"Max Slope: \",\n\t\t\tvalue: (track) => Math.round(track.slope_max || 0) + '&nbsp;' + slope.label\n\t\t}\n\t});\n\n\n});\n","import 'leaflet-i18n';\nimport * as _        from './utils';\nimport * as D3       from './components';\nimport { Elevation } from './control';\n\nElevation.addInitHook(function() {\n\n\tif (!this.options.speed && !this.options.acceleration) return;\n\n\tlet opts = this.options;\n\tlet speed = {};\n\n\tspeed.label          = opts.speedLabel  || L._(this.options.imperial ? 'mph' : 'km/h');\n\tthis._speedFactor    = opts.speedFactor || 1;\n\n\tif (this.options.speed && this.options.speed != \"summary\") {\n\n\t\tthis._registerAxisScale({\n\t\t\taxis       : \"y\",\n\t\t\tposition   : \"right\",\n\t\t\tscale      : {\n\t\t\t\tmin        : 0,\n\t\t\t\tmax        : +1,\n\t\t\t},\n\t\t\ttickPadding: 16,\n\t\t\tlabel      : speed.label,\n\t\t\tlabelX     : 25,\n\t\t\tlabelY     : -8,\n\t\t\tname       : \"speed\"\n\t\t});\n\n\t\tthis._registerAreaPath({\n\t\t\tname       : 'speed',\n\t\t\tlabel      : 'Speed',\n\t\t\tyAttr      : \"speed\",\n\t\t\tscaleX     : 'distance',\n\t\t\tscaleY     : 'speed',\n\t\t\tcolor      : '#03ffff',\n\t\t\tstrokeColor  : '#000',\n\t\t\tstrokeOpacity: \"0.5\",\n\t\t\tfillOpacity  : \"0.25\",\n\t\t});\n\n\t}\n\n\tthis.on('elepoint_added', function(e) {\n\t\tlet data   = this._data;\n\t\tlet i      = e.index;\n\n\t\tlet currT  = data[i].time;\n\t\tlet prevT  = i > 0 ? data[i - 1].time : currT;\n\n\t\tlet deltaT = currT - prevT;\n\n\t\tlet track  = this.track_info;\n\t\tlet sMax   = track.speed_max || -Infinity; // Speed Max\n\t\tlet sMin   = track.speed_min || +Infinity; // Speed Min\n\t\tlet sAvg   = track.speed_avg || 0;         // Speed Avg\n\t\tlet speed  = 0;\n\n\t\tif (deltaT > 0) {\n\t\t\tlet delta = (data[i].dist - data[i > 0 ? i - 1 : i].dist) * 1000;\n\t\t\tspeed = Math.abs((delta / deltaT) * this._timeFactor) * this._speedFactor;\n\t\t}\n\n\t\t// Try to smooth \"crazy\" speed values.\n\t\tif (this.options.speedDeltaMax) {\n\t\t\tlet deltaS    = i > 0 ? speed - data[i - 1].speed : 0;\n\t\t\tlet maxDeltaS = this.options.speedDeltaMax;\n\t\t\tif (Math.abs(deltaS) > maxDeltaS) {\n\t\t\t\tspeed       = data[i - 1].speed + maxDeltaS * Math.sign(deltaS);\n\t\t\t}\n\t\t}\n\n\t\t// Range of acceptable speed values.\n\t\tif (this.options.speedRange) {\n\t\t\tlet range = this.options.speedRange;\n\t\t\tif (speed < range[0])      speed = range[0];\n\t\t\telse if (speed > range[1]) speed = range[1];\n\t\t}\n\n\t\tspeed = L.Util.formatNum(speed, 2);\n\n\t\tsMax = speed > sMax ? speed : sMax;\n\t\tsMin = speed < sMin ? speed : sMin;\n\t\tsAvg = (speed + sAvg) / 2.0;\n\n\t\tdata[i].speed = speed;\n\n\t\ttrack.speed_max = sMax;\n\t\ttrack.speed_min = sMin;\n\t\ttrack.speed_avg = sAvg;\n\t});\n\n\tif (this.options.speed) {\n\n\t\tthis._registerFocusLabel({\n\t\t\tname: 'speed',\n\t\t\tchart: (item) => item.speed + \" \" + speed.label,\n\t\t\tmarker: (item) => Math.round(item.speed) + \" \" + speed.label\n\t\t});\n\n\t\tthis._registerSummary({\n\t\t\t\"minspeed\"  : {\n\t\t\t\tlabel: \"Min Speed: \",\n\t\t\t\tvalue: (track) => Math.round(track.speed_min || 0) + '&nbsp;' + speed.label\n\t\t\t},\n\t\t\t\"maxspeed\"  : {\n\t\t\t\tlabel: \"Max Speed: \",\n\t\t\t\tvalue: (track) => Math.round(track.speed_max || 0) + '&nbsp;' + speed.label\n\t\t\t},\n\t\t\t\"avgspeed\": {\n\t\t\t\tlabel: \"Avg Speed: \",\n\t\t\t\tvalue: (track) => Math.round(track.speed_avg || 0) + '&nbsp;' + speed.label\n\t\t\t}\n\t\t});\n\n\t}\n\n});\n","import 'leaflet-i18n';\nimport * as _        from './utils';\nimport * as D3       from './components';\nimport { Elevation } from './control';\n\nElevation.addInitHook(function() {\n\n\tif (!this.options.acceleration) return;\n\n\tlet opts = this.options;\n\tlet acceleration = {};\n\n\tacceleration.label       = opts.accelerationLabel  || L._(this.options.imperial ? 'ft/s²' : 'm/s²');\n\tthis._accelerationFactor = opts.accelerationFactor || 1;\n\n\tif (this.options.acceleration != \"summary\") {\n\n\t\tthis._registerAxisScale({\n\t\t\taxis       : \"y\",\n\t\t\tposition   : \"right\",\n\t\t\tscale      : {\n\t\t\t\tmin        : 0,\n\t\t\t\tmax        : +1,\n\t\t\t},\n\t\t\ttickPadding: 16,\n\t\t\tlabel      : acceleration.label,\n\t\t\tlabelX     : 25,\n\t\t\tlabelY     : -8,\n\t\t\tname       : 'acceleration'\n\t\t});\n\n\t\tthis._registerAreaPath({\n\t\t\tname       : 'acceleration',\n\t\t\tlabel      : 'Acceleration',\n\t\t\tyAttr      : 'acceleration',\n\t\t\tscaleX     : 'distance',\n\t\t\tscaleY     : 'acceleration',\n\t\t\tcolor      : '#050402',\n\t\t\tstrokeColor  : '#000',\n\t\t\tstrokeOpacity: \"0.5\",\n\t\t\tfillOpacity  : \"0.25\",\n\t\t});\n\n\t}\n\n\tthis.on('elepoint_added', function(e) {\n\t\tlet data   = this._data;\n\t\tlet i      = e.index;\n\n\t\tlet currT  = data[i].time;\n\t\tlet prevT  = i > 0 ? data[i - 1].time : currT;\n\n\t\tlet deltaT = (currT - prevT) / 1000;\n\n\t\tlet track  = this.track_info;\n\t\tlet sMax   = track.acceleration_max || -Infinity; // Acceleration Max\n\t\tlet sMin   = track.acceleration_min || +Infinity; // Acceleration Min\n\t\tlet sAvg   = track.acceleration_avg || 0; // Acceleration Avg\n\t\tlet acceleration = 0;\n\n\t\tif (deltaT > 0) {\n\t\t\tlet curr     = data[i].speed;\n\t\t\tlet prev     = i > 0 ? data[i - 1].speed : curr;\n\t\t\tlet delta    = (curr - prev) * (1000 / this._timeFactor);\n\t\t\tacceleration = Math.abs((delta / deltaT)) * this._accelerationFactor;\n\t\t}\n\n\t\t// Try to smooth \"crazy\" acceleration values.\n\t\tif (this.options.accelerationDeltaMax) {\n\t\t\tlet deltaA     = i > 0 ? acceleration - data[i - 1].acceleration : 0;\n\t\t\tlet maxDeltaS  = this.options.accelerationDeltaMax;\n\t\t\tif (Math.abs(deltaA) > maxDeltaS) {\n\t\t\t\tacceleration = data[i - 1].acceleration + maxDeltaS * Math.sign(deltaA);\n\t\t\t}\n\t\t}\n\n\t\t// Range of acceptable acceleration values.\n\t\tif (this.options.accelerationRange) {\n\t\t\tlet range = this.options.accelerationRange;\n\t\t\tif (acceleration < range[0])      acceleration = range[0];\n\t\t\telse if (acceleration > range[1]) acceleration = range[1];\n\t\t}\n\n\t\tacceleration = L.Util.formatNum(acceleration, 2);\n\n\t\tif (acceleration > sMax) sMax = acceleration;\n\t\tif (acceleration < sMin) sMin = acceleration;\n\t\tsAvg = (acceleration + sAvg) / 2.0;\n\n\t\tdata[i].acceleration = acceleration;\n\n\t\ttrack.acceleration_max = sMax;\n\t\ttrack.acceleration_min = sMin;\n\t\ttrack.acceleration_avg = sAvg;\n\t});\n\n\tthis._registerFocusLabel({\n\t\tname  : 'acceleration',\n\t\tchart : (item) => item.acceleration + \" \" + acceleration.label,\n\t\tmarker: (item) => Math.round(item.acceleration) + \" \" + acceleration.label,\n\t});\n\n\tthis._registerSummary({\n\t\t\"minacceleration\"  : {\n\t\t\tlabel: \"Min Acceleration: \",\n\t\t\tvalue: (track) => Math.round(track.acceleration_min || 0) + '&nbsp;' + acceleration.label\n\t\t},\n\t\t\"maxacceleration\"  : {\n\t\t\tlabel: \"Max Acceleration: \",\n\t\t\tvalue: (track) => Math.round(track.acceleration_max || 0) + '&nbsp;' + acceleration.label\n\t\t},\n\t\t\"avgacceleration\": {\n\t\t\tlabel: \"Avg Acceleration: \",\n\t\t\tvalue: (track) => Math.round(track.acceleration_avg || 0) + '&nbsp;' + acceleration.label\n\t\t}\n\t});\n\n});\n","/*\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\n *\n *  This file is free software: you may copy, redistribute and/or modify it\n *  under the terms of the GNU General Public License as published by the\n *  Free Software Foundation, either version 2 of the License, or (at your\n *  option) any later version.\n *\n *  This file is distributed in the hope that it will be useful, but\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n *  General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see .\n *\n * This file incorporates work covered by the following copyright and\n * permission notice:\n *\n *     Copyright (c) 2013-2016, MIT License, Felix “MrMufflon” Bache\n *\n *     Permission to use, copy, modify, and/or distribute this software\n *     for any purpose with or without fee is hereby granted, provided\n *     that the above copyright notice and this permission notice appear\n *     in all copies.\n *\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n */\n\nimport 'leaflet-i18n';\nimport * as _ from './utils';\nimport * as D3 from './components';\nimport { Chart } from './chart';\nimport { Elevation } from './control';\nimport './distance';\nimport './altitude';\nimport './time';\nimport './slope';\nimport './speed';\nimport './acceleration';\n\nElevation.Utils = _;\nElevation.Components = D3;\nElevation.Chart = Chart;\n\nL.control.elevation = (options) => new Elevation(options);\n"],"names":["deepMerge","target","sources","length","source","shift","isObject","key","Object","assign","deferFunc","f","document","readyState","window","addEventListener","once","factory","define","amd","exports","module","require","L","locales","locale","registerLocale","code","Util","extend","setLocale","i18n","_","string","data","template","err","formatTime","t","d","Math","floor","HOUR","h","MIN","m","SEC","s","round","toString","padStart","GeoJSONLoader","control","JSON","parse","distanceMarkers","this","options","lazy","layer","geoJson","style","feature","polyline","theme","className","pointToLayer","latlng","marker","icon","gpxOptions","marker_options","wptIcons","prop","properties","desc","name","bindPopup","openPopup","_registerCheckPoint","label","fire","point","point_type","element","onEachFeature","geometry","type","_latlngs","forEach","i","meta","time","ele","hr","cad","atemp","alt","Date","coordTimes","times","_typeof","parseInt","heartRates","heartRate","addData","on","e","path","DistanceMarkers","Polyline","track_info","Control","Elevation","_d3LazyLoader","then","_fireEvt","item","Array","isArray","isVisible","elem","styles","getComputedStyle","visibility","display","isVisibleByStyles","boundingRect","getBoundingClientRect","left","right","top","above","bottom","pointerEvents","elementFromPoint","isAboveOtherElements","isJSONDoc","doc","trim","indexOf","console","warn","isXMLDoc","documentElement","ownerDocument","nodeName","lazyLoader","url","skip","loader","Promise","resolve","reject","tag","createElement","src","head","appendChild","saveFile","dataURI","fileName","a","create","href","download","b","body","click","removeChild","waitHolder","ticking","scrollFn","requestAnimFrame","removeEventListener","addClass","targetNode","split","every","DomUtil","removeClass","toggleClass","conditional","call","replaceClass","removeClassName","addClassName","value","getStyle","setProperty","toggleStyle","toggleEvent","leafletElement","eventName","handler","tagName","attributes","parent","setAttributes","append","child","insert","position","insertAdjacentElement","attrs","k","setAttribute","select","selector","context","querySelector","DomEvent","off","hasClass","randomId","random","substr","each","obj","fn","func","wait","immediate","timeout","args","arguments","clearTimeout","setTimeout","apply","offsetWidth","offsetHeight","getClientRects","Colors","area","alpha","stroke","line","Area","width","height","xAttr","yAttr","scaleX","scaleY","interpolation","d3","curve","x","xDiagCoord","y0","y1","Path","color","strokeColor","strokeOpacity","fillOpacity","classed","attr","Axis","tickSize","tickPadding","axis","scale","ticks","tickFormat","labelX","labelY","onAxisMount","g","w","axisScale","replace","l","toUpperCase","axisGroup","join","text","Grid","props","HeightFocusLine","xCoord","yCoord","HeightFocusLabel","y","node","selectAll","HeightFocusMarker","circle","LegendItem","margins","toLowerCase","svg","ownerSVGElement","dispatch","detail","legend","enabled","MouseFocusLine","MouseFocusLabel","rect","xAlign","yAlign","bbox","getBBox","max","Browser","webkit","Infinity","Ruler","symbol","symbolTriangle","exit","remove","enter","merge","size","angle","Domain","min","forceBounds","domain","extent","Range","Scale","range","scaleLinear","Chart","_width","ruler","_height","panes","grid","brush","tooltip","clipPath","clipRect","foreignObject","canvas","getContext","dragG","focusG","brushG","brushX","utils","chart","opts","_resize","bisector","invert","Class","includes","Evented","prototype","Mixin","Events","initialize","_data","_props","scales","paths","areas","grids","axes","legendItems","focusLabels","_scales","_domains","_ranges","_paths","_brushEnabled","dragging","_zoomEnabled","zooming","imperial","_xLabel","_yLabel","xLabel","yLabel","_chart","D3","_container","_grid","pane","_area","_point","_axis","_legend","_initScale","_clipPath","get","_canvas","_context","_dragG","_focusG","_brush","_focusline","_focuslabel","_zoom","zoom","_drag","drag","_initInteractions","update","_updateScale","_updateArea","_updateAxis","_updateLegend","_updateClipper","render","container","_this","clear","_resetDrag","clearRect","_path","_drawPath","ctx","datum","preferCanvas","beginPath","moveTo","p","Path2D","strokeStyle","fillStyle","lineWidth","globalCompositeOperation","globalAlpha","fill","closePath","_hasActiveLayers","_initBrush","focus","sourceEvent","_this2","pointers","_findIndexForXCoord","filter","shiftKey","button","selection","start","end","dragstart","dragend","bind","_initClipper","margin","scaleExtent","translateExtent","_this3","buttons","transform","distance","_x","rescaleX","_hideDiagramIndicator","_initRuler","_initLegend","_this4","formatNum","format","yMax","_this5","z","_y","coords","_findCoordsForY","_registerAxisScale","xAxisMin","xAxisMax","yAxisMin","yAxisMax","altitude","_registerAreaPath","_registerAxisGrid","forceAxisBounds","xTicks","yTicks","_findIndexForLatLng","dist","isNaN","property","pos","y2","x2","_registerFocusLabel","gridOpts","axesOpts","n","translate","substring","legends","items","nodes","v","map","sign","rev","slice","reverse","push","concat","xAxesB","marginB","marginR","_this6","tx","ty","r","next","list","reduce","array","index","curr","_this7","result","distanceTo","_resetZoom","zoomIdentity","_showDiagramIndicator","xCoordinate","yCoordinate","decimalsX","decimalsY","labels","Marker","_focusmarker","_marker","markerIcon","zIndexOffset","interactive","_focuslabels","addTo","_map","getPane","_latlng","latLngToLayerPoint","_rotate","rotatedPointToMapPanePoint","normalizedAlt","maxElevation","normalizedY","getElement","setLatLng","getLatLng","Summary","summary","reset","innerHTML","_registerSummary","Options","autofitBounds","autohide","mobile","autohideMarker","almostover","collapsed","detached","distanceFactor","downloadLink","elevationDiv","followMarker","async","startIconUrl","endIconUrl","shadowUrl","divIcon","html","iconSize","iconAnchor","heightFactor","lazyLoadJS","loadData","defer","placeholder","opacity","weight","lineCap","polylineSegments","reverseCoords","skipNullZCoords","responsive","slope","speed","sLimit","undefined","timeFactor","timeFormat","sDeltaMax","sInterpolation","sRange","zFollow","Mobile","__mileFactor","__footFactor","__D3","__TOGEOJSON","__LGEOMUTIL","__LALMOSTOVER","__LDISTANCEM","_addData","_addLayer","eleDiv","_initElevationDiv","isConnected","getContainer","onAdd","_layers","clearLayers","disableBrush","enableBrush","enableDragging","enableBrushing","disableDragging","disableBrushing","disableZoom","enableZoom","fitBounds","bounds","getBounds","isValid","latLngBounds","getZFollow","_zFollow","hide","featureGroup","_markedSegments","_chartEnabled","_setMapView","throttle","setStyle","colors","load","loadChart","loadDefer","loadLazy","loadXML","loadGeoJSON","loadFile","fetch","response","_downloadURL","catch","loadGPX","_togeojsonLazyLoader","toGeoJSON","xml","DOMParser","parseFromString","geojson","getElementsByTagName","pop","parentNode","_initButton","_initChart","_initSummary","_initMarker","_initLayer","_hideMarker","_resetView","_resizeChart","_rotateMarker","_updateChart","_updateSummary","onRemove","redraw","setZFollow","show","geom","_addGeoJSONData","coordinates","features","_addGPXData","_addPoint","_this8","lat","lng","latLng","addLayer","id","_collapse","_expand","_findItemForLatLng","_findItemForX","propagate","_xTicks","_yTicks","clientWidth","_maxWidth","maxWidth","_dragendHandler","_mousemoveHandler","_mouseoutHandler","_rulerFilterHandler","_toggleChartHandler","_this9","_mousemoveLayerHandler","_pane","createPane","zIndex","_renderer","disableClickPropagation","stopPropagation","_mousewheelHandler","link","_button","title","stop","_toggle","_summary","summaryDiv","_updateMarker","gestureHandling","_enabled","ll","getCenter","getZoom","deltaY","flyTo","_this10","_this11","_this12","_this13","_this14","_this15","_isFullscreen","newWidth","_updateMapSegments","setView","animate","duration","contains","eachLayer","_this16","elevation_max","setLatLngs","hasLayer","onclick","preventDefault","_this17","confirm","__xTicks","__yTicks","addInitHook","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","CustomEvent","dispatchEvent","_this18","_geomutilLazyLoader","GeometryUtil","almostOver","_almostoverLazyLoader","Handler","AlmostOver","addHandler","_distanceMarkersLazyLoader","oldProto","Canvas","_fillStroke","include","oldVal","_distanceFactor","track","prev","delta","toFixed","_heightFactor","eleMax","eleMin","elevation_min","prevZ","lastZ","_lastValidZ","currZ","splice","timeLabel","_timeFactor","_timeAVGSpeed","timeAVGSpeed","speedFactor","toLocaleTimeString","toLocaleDateString","toLocaleString","replaceAll","xTimeFormat","getTime","now","getTimezoneOffset","currT","prevT","deltaT","abs","slopeLabel","tAsc","ascent","tDes","descent","sMax","slope_max","sMin","slope_min","deltaZ","deltaS","maxDeltaS","acceleration","speedLabel","_speedFactor","speed_max","speed_min","sAvg","speed_avg","speedDeltaMax","speedRange","accelerationLabel","_accelerationFactor","accelerationFactor","acceleration_max","acceleration_min","acceleration_avg","accelerationDeltaMax","deltaA","accelerationRange","Utils","Components","elevation"],"mappings":"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"}